!function(e){function t(e,t,o){for(var i="undefined"!=typeof o?[o]:document.styleSheets,s=0,n=i.length;s<n;s++)if(o=i[s],o.cssRules)for(var a=0,r=o.cssRules.length;a<r;a++){var l=o.cssRules[a];if(l.selectorText&&l.selectorText.split(",").indexOf(t)!==-1)return l.style[e]}return null}var o={project:{preload:[],namespace:"ym",jsonpPrefix:"",loadLimit:500},ns:{},env:{},envCallbacks:[]};o.modules=e.ym.modules,o.modules.define("mf.localization",["mf.env"],function(e,t){var o={en:{widget:{GOTO_YMAPS:"See full-size map",search_button_text:"%found% found",search_footer:'Didn\'t find what you were looking for? <div style="display: inline-block">Try changing the zoom level</div><br/> or <a href=# class=search-popup-ymaps-link target=_blank>refining your search</a>',search_more_button:"%_found_% (more result|more results|more results)",search_result:'Search results for "%text%"'}},fr:{widget:{GOTO_YMAPS:"",search_button_text:"",search_footer:"",search_more_button:"",search_result:""}},ru:{widget:{GOTO_YMAPS:"На большую карту",search_button_text:"%found% найдено",search_footer:'Не нашли, что искали, — <div style="display: inline-block">измените масштаб</div><br/> или <a href=# class=search-popup-ymaps-link target=_blank>уточните запрос</a>',search_more_button:"Ещё %_found_% (результат|результата|результатов)",search_result:"Результаты поиска «%text%»"}},tr:{widget:{GOTO_YMAPS:"Haritalar'da aç",search_button_text:"%found% bulundu",search_footer:"Aradığınızı bulamıyorsanız ölçüyü değiştirin<br/> veya <a href=# class=search-popup-ymaps-link target=_blank>sorgunuzu netleştirin</a> ",search_more_button:"Daha %_found_% (sonuç|sonuç|sonuç)",search_result:'"%text%" için arama sonuçları'}},uk:{widget:{GOTO_YMAPS:"На велику карту",search_button_text:"%found% знайдено",search_footer:'Не знайшли, що шукали, — <div style="display: inline-block">змініть масшта</div><br/> або <a href=# class=search-popup-ymaps-link target=_blank>уточніть запит</a>',search_more_button:"Ще %_found_% (результат|результати|результатів)",search_result:"Результати пошуку «%text%»"}}};e(o[t.lang]&&o[t.lang].widget)}),o.modules.define("mf.controller.activeObjects",["vow","mf.search.provider","mf.search.Collection","data.Manager","util.defineClass","map.associate.serviceGeoObjects","mf.search.setupBalloonPane","mf.search.inceptionHelper","mf.search.displayModeHelper"],function(e,t,o,i,s,n,a,r,l,c){var u=n(function(e,n){this._map=e;var u=n.get("activeObjects");this._state=new s({results:[]}),r(e),c(e,this._state),this._collection=new i(this._state),a.get(e).add(this._collection),this._collection.options.unset("balloonMinHeight"),this._collection.events.add("childBalloonOpen",this._onItemBalloonOpen,this).add("childBalloonClose",this._onItemBalloonClose,this),this._searchProvider=n.get("searchProvider")||o;var p=[];u.forEach(function(e){p.push(this._searchProvider.search(e.request).then(function(o){if(0===o.geoObjects.getLength())return t.reject("Object not found");var i=o.geoObjects.get(0);return e.position&&i.geometry.setCoordinates(e.position),this._collection.add(i),n.get("mode")===e.source?(this._collection.setActiveChild(i),l.setSearchDefault(this._map,{request:i.properties.get("address")}),this._collection.openChildBalloon(i)):i.options.set("preset","islands#blueCircleDotIconWithCaption"),o},this))},this),this._requests=t.all(p)},{getRequests:function(){return this._requests},getResultCollection:function(){return this._collection},_onItemBalloonOpen:function(e){l.setSearch(this._map,{request:e.get("target").properties.get("address")})},_onItemBalloonClose:function(){l.resetSearch(this._map)}});e(function(e,o){var i=o.get("activeObjects");return i&&i.length?t.resolve(new u(e,o)):t.reject("no activeObject data")})}),o.modules.define("mf.controller.constructor",["mf.util.jsLoader","mf.hosts","vow","GeoObject","GeoObjectCollection","map.associate.serviceGeoObjects","option.presetStorage","ObjectManager","templateLayoutFactory"],function(e,t,o,i,s,n,a,r,l,c){function u(e){if("#"===e[0])return d.toString()+e.toString();if(e.indexOf("___sport")>-1){var t=e.split("___");return["islands#",t[1],"Run",t[0].indexOf("circle")>-1?"CircleIcon":"Icon"].join("")}return e.replace(/^twirl#/,"islands#").replace(/^default#/,"islands#").replace(/Dot$/,"Icon").replace("white","gray")}function p(){var e=c.createClass("{{ properties.iconContent }}",{build:function(){e.superclass.build.call(this);var t=this.getData().properties.get("iconContent");if(t&&String(t).length>2){var o=this.getElement();o.style.fontSize="9px",o.style.lineHeight="16px",o.style.display="block"}}});return{strokeOpacity:1,fillOpacity:1,strokeColor:"ff0000e6",strokeWidth:5,fillColor:"ff000099",balloonContentLayout:c.createClass("{{ properties.name|raw }}"),iconContentLayout:e,zIndexActive:Math.pow(10,9)+10,zIndexHover:Math.pow(10,9)+9}}var d;e(function(e,t){function o(){var t=h.geoObjects;if(t){var o=new n;o.options.set(p()),a.get(e).add(o),t.features.forEach(function(e,t){e.id=t+1,e.options=e.options||{},e.options.zIndex=e.options.zIndex||t+1,e.options.preset=u(e.options.preset||""),o.add(new s({geometry:e.geometry,properties:e.properties},e.options))})}l.resolve()}var l=i.defer(),c=t.get("userMap");if(!c||!c.maps||!c.maps[0])return l.reject(),l.promise();var h=c.maps[0];e.state.set({mapSid:d=t.get("mapSid"),mapSourceType:t.get("mapSourceType")});var g=c.presetStorage;if(g)for(var m in g)g.hasOwnProperty(m)&&r.add(m,g[m]);return o(),l.promise()})}),o.modules.define("distribution.styl",["system.provideCss"],function(e,t){t(".goto-ymaps{display:block;text-align:center}.goto-ymaps-content{padding-left:18px;background-image:url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTQiIGhlaWdodD0iMjMiIHZpZXdCb3g9IjAgMCAxNCAyMyIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtLjUgLS4yMjIpIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjxwYXRoIGQ9Ik01LjUgMjMuMjIybDUuNTM1LTcuNTdzMS42LTIuMTg1IDIuNjEtNC4xNWMxLjAxLTEuOTY2Ljg0NS00LjI4Ljg0NS00LjI4TDggMTMuMiA1LjUgMjMuMjJ6IiBmaWxsPSIjQ0QwMDAwIi8+PGNpcmNsZSBmaWxsPSIjRTAwIiBjeD0iNy41IiBjeT0iNy4yMjIiIHI9IjciLz48ZWxsaXBzZSBmaWxsPSIjRkZGIiBjeD0iNy41IiBjeT0iNy4yMjIiIHJ4PSIzIiByeT0iMyIvPjwvZz48L3N2Zz4=);background-size:10px 16px;background-repeat:no-repeat;background-position:left center;display:inline-block}.goto-ymaps-content-lite{padding-left:0;background:0 0}",e)}),o.modules.define("mf.controller.distribution",["mf.hosts","mf.localization","distribution.styl","control.Button","meta","mf.query","mf.util.ymapsLink","system.browser","yandex.counter","util.dom.className"],function(e,t,o,i,s,n,a,r,l,c,u){function p(e){function t(e){var t=e.getElement();t&&t.firstChild&&t.parentNode&&(t.firstChild.style.width="100%",t.firstChild.firstChild&&(t.firstChild.firstChild.style.padding="0px"))}g=new s({data:{content:["<ymaps class=goto-ymaps><ymaps class=goto-ymaps-content>",o.GOTO_YMAPS,"</ymaps></ymaps>"].join("")},options:{maxWidth:"99999",selectOnClick:!1}}),e.controls.add(g,{position:{left:10,right:10,bottom:5}}),g.getLayoutSync()?t(g.getLayoutSync()):g.getLayout().then(t),e.panes.get("copyrights").getElement().style.marginBottom="29px",d(e)}function d(e){function t(t){var o=t.getElement().querySelector(".goto-ymaps-content"),i=e.container.getSize();i[0]<175?u.add(o,"goto-ymaps-content-lite"):u.remove(o,"goto-ymaps-content-lite")}g&&(g.getLayoutSync()?t(g.getLayoutSync()):g.getLayout().then(t))}var h,g;e({show:function(e){function t(e){c.countByKey("distribution",[e,l.platform,n.version.replace(/\W/g,"_")].join("."))}e.options.set({copyrightLogoVisible:!1,suppressMapOpenBlock:!0}),p(e),g.events.add("click",function(){window.open(r.getStateLink(e,a)),t("mapsButton.smallMap")})},onResize:function(e){d(e)},hide:function(e){g&&e.controls.remove(g),e.panes.get("copyrights").getElement().style.marginBottom="0px",e.options.unset("copyrightLogoVisible"),e.options.set("suppressMapOpenBlock",!1),h&&(h.removeAll(),h=null)}})}),o.modules.define("mf.controller.poi",["vow","Placemark","yandex.layer.poi"],function(e,t,o,i){function s(e,t){return e.uri?e.uri===t.get("uri"):e.name===t.get("name")}e(function(e,n){var a=n.get("poi"),r=i.get(e);return a&&r?r.getHotspotLayer().then(function(i){return i.getObjectInPosition(a).then(function(r){var l,c=r.getProperties(),u="poi"===n.get("mode");return c&&(l=new o(a,{iconCaption:c.name},{preset:"islands#redDotIconWithCaption",visible:!u}),e.geoObjects.add(l),l.events.add("click",function(){i.balloon.open(r)})),l&&i.events.add("balloonopen",function(){var e=i.balloon.getOverlaySync().getLayoutSync(),t=e.getData().properties;s(r.getProperties(),t)&&l.options.set("visible",!1)}).add("balloonclose",function(){l.options.unset("visible")}),u?i.balloon.open(r):t.resolve()},this)},this):t.resolve()})}),o.modules.define("mf.controller.points",["vow","Placemark"],function(e,t,o){e(function(e,i){var s=i.get("placemarks");return s&&s.forEach(function(t){e.geoObjects.add(new o(t.geometry.coordinates,{},t.options))}),t.resolve()})}),o.modules.define("mf.controller.resize",["vow","mf.controller.distribution","mf.search.Control"],function(e,t,o,i){var s=[220,200],n=["rulerControl","trafficControl","geolocationControl"];e(function(e,a){function r(){for(var t=e.container.getSize(),r=t[0]<s[0],l=r||t[1]<s[1],c=0,u=n.length;c<u;c++)e.controls.get(n[c]).options.set("visible",!l);e.controls.each(function(e){e instanceof i&&e.options.set("visible",!l)}),!e.state.get("narrowMode")&&e.options.get("suppressMapOpenBlock",!1)||(e.state.get("narrowMode")!==r?r?o.show(e,a):o.hide(e,a):r&&o.onResize(e,a)),e.state.get("compactMode")!==l&&(l?e.controls.get("zoomControl").options.set({size:"small",position:{top:10,left:10}}):e.controls.get("zoomControl").options.unset(["size","position"])),e.state.set({compactMode:l,narrowMode:r})}return e.events.add("sizechange",r),e.controls.events.add("add",r),r(),t.resolve()})}),o.modules.define("mf.controller.route",["vow","route","geocode","mf.geoObject.GhostWayPoint","multiRouter.component.RouteBalloon"],function(e,t,o,i,s,n){function a(e,t){var o=t.emptyIndex,i=1===o?0:1,n=e.getWayPoints(),a=n.get(i);a.options.set({draggable:!1,cursor:"arrow"}),e.getMap().events.once("click",function(t){c.destroy();var i=e.model.getReferencePoints().concat();i[o]=t.get("coords"),e.model.setReferencePoints(i),n.get(o).options.set("draggable",!0),a.options.set("cursor","grab")}),e.events.add("update",function(){a.properties.set("name",u[i]),n.getLength()>1&&r(n.get(o),o,2)}),c=new s(e.getMap(),o)}function r(e,o,s){var n=e.geometry.getCoordinates();return n?i(e.geometry.getCoordinates()).then(function(t){var i=t.geoObjects.get(0);if(i){var n=i.properties.get("name");u[o]=n,0!==o&&o!==s-1?l(e,n):(e.properties.set("name",n),e.options.set("cursor",e.options.get("draggable")?"pointer":"grab"))}}):t.resolve()}function l(e,t){e.events.add("click",function(){var o=e.properties;o.set("name",o.get("name")?"":t)})}var c,u={};e(function(e,i){var s=i.get("route");if(!s)return t.resolve();var l=t.defer();return o(s.wayPoints,{multiRoute:!0,routingMode:s.type,viaIndexes:s.viaIndexes,activeRouteAutoSelection:!1,avoidTrafficJams:s.avoidTrafficJams}).then(function(o){if(o.options.set({routeActiveWalkSegmentStrokeColor:"#6000FF",routeMarkerCursor:"grab"}),o.getViaPoints().events.add("click",function(e){n.get(o.getActiveRoute()).open(e.get("coords"))}),s.rtn){var i=o.getRoutes(),c=i.get(s.rtn);c&&o.setActiveRoute(c)}var u=o.getWayPoints(),p=[],d=u.getLength();u.each(function(e,t){p.push(r(e,t,d))}),t.all(p).always(function(){e.geoObjects.add(o),l.resolve(),s.hasOwnProperty("emptyIndex")&&a(o,s)})},function(e){l.reject(e)}),l.promise()})}),o.modules.define("mf.controller.ruler",["vow"],function(e,t){e(function(e,o){return e.behaviors.get("ruler").setState(o.get("rulerState")),t.resolve()})}),o.modules.define("scrollZoom.styl",["system.provideCss"],function(e,t){t(".ymaps-scroll-blocker{position:absolute;top:0;left:0;width:100%;height:100%}",e)}),o.modules.define("mf.controller.scrollZoom",["vow","domEvent.manager","util.defineClass","mf.ua","scrollZoom.styl"],function(e,t,o,i,s){var n=3,a=150,r=i(function(e){this._map=e,this._count=0,this._blocker=document.createElement("div"),this._blocker.className="ymaps-scroll-blocker",this._eventsList.forEach(function(e){this["on"+e+"Bound"]=this["on"+e].bind(this),document.documentElement.addEventListener(e.toLowerCase(),this["on"+e+"Bound"])},this),e.events.add("wheel",this.onMapWheel,this)},{destruct:function(){this._setScrollState(!0),this._blocker=null,this._eventsList.forEach(function(e){document.documentElement.removeEventListener(e.toLowerCase(),this["on"+e+"Bound"])},this),this._map.events.remove(document.documentElement,"wheel",this.onWheel,this)},_scrollState:!0,_over:!1,_setScrollState:function(e){this._scrollState!==e&&document.body[(e?"remove":"append")+"Child"](this._blocker),this._scrollState=e},_eventsList:["MouseEnter","MouseMove","MouseWheel","MouseLeave"],onMouseEnter:function(){this._over=!0,clearTimeout(this._timeout)},onMapWheel:function(e){this._over||this._scrollState!==!0||(this._count=0,this._setScrollState(!1),e.preventDefault())},onMouseWheel:function(){document.documentElement.removeEventListener("mousewheel",this.onMouseWheelBound),this._timeout=setTimeout(function(){this._setScrollState(!0),this._over=!0}.bind(this),a)},onMouseMove:function(){this._count++,this._count>=n&&this._setScrollState(!0)},onMouseLeave:function(){this._count=0,this._over=!1,this._setScrollState(!0)}});e(function(e,o){return s.isTouch?t.resolve():t.resolve(new r(e,o))})}),o.modules.define("mf.controller.search",["mf.search.provider","mf.search.Control","mf.search.Collection","data.Manager","util.defineClass","pane.StaticPane","vow","util.extend","util.bounds","Monitor","mf.meta.config","mf.util.id","mf.search.setupBalloonPane","mf.search.displayModeHelper","map.associate.serviceGeoObjects","mf.search.inceptionHelper"],function(e,t,o,i,s,n,a,r,l,c,u,p,d,h,g,m,f){var I=n(function(e,o){this._map=e;var n=o.get("search");this._searchProvider=o.get("searchProvider")||t,this._request=l({},n.request),this._isSearchMode="search"===o.get("mode"),n.showControl?this._setupControl():this._state=new s({results:[]}),this._state.set("originRequest",this._request),h(e),g(e,this._state),this._resultCollection=new i(this._state),m.get(e).add(this._resultCollection),this._resultCollection.events.add("childBalloonOpen",this._onItemBalloonOpen,this).add("childBalloonClose",this._onItemBalloonClose,this).add("childAutopanStart",this._onChildAutopanStart,this).add("childAutopanEnd",this._onChildAutopanEnd,this),this._makeRequest(!0).then(this._firstRequestHandler,this),this._map.events.add("click",this._deselectButton,this).add("boundschange",this._onMapBoundsChange,this).add("balloonopen",this._onMapBalloonOpen,this),this._searchControl&&this._map.controls.get("trafficControl").events.add("expand",this._checkPopupVisibility,this),this._setMapState()},{getCurrentRequest:function(){return this._currentRequest},getResultCollection:function(){return this._resultCollection},_setupControl:function(){this._searchControl=new o({data:{request:this._request}}),this._state=this._searchControl.state,this._searchControl.events.add("select",function(){var e=this._map.balloon;e.isOpen()&&e.close(!0)},this).add("loadmorerequest",function(){this._makeRequest()},this).add("resultselect",this._onResultSelect,this),this._stateMonitor=new u(this._state),this._stateMonitor.add("displayMode",this._checkButtonVisibility,this)},_makeRequest:function(e){if(!this._currentRequest||e){e&&(this._requestSkip=0);var t=[this._searchProvider.search(this._getRequestObject())];e&&this._request.business_oid&&t.push(this._searchProvider.search(this._getRequestObject(!0))),e&&this._state.set("requestId",this._state.get("requestId",0)+1),this._currentRequest=r.all(t);var o=this._currentRequest;o.id=d.get(),this._currentRequest.spread(function(t,i){if(this._currentRequest&&o.id===this._currentRequest.id){this._currentRequest=null;var s,n=e?[]:this._state.get("results",[]),a=t.geoObjects.properties.getAll(),r=a.resultsArray.concat(),c=this._selectedResult&&Number(this._selectedResult.properties.get("id"));i&&c===this._request.business_oid&&(i=null);var u;if(i&&(u=!r.every(function(e,o){return Number(e.properties.get("id"))!==this._request.business_oid||(t.geoObjects.remove(e),r.splice(o,1),!1)},this),u||a.found++),c&&(u=!r.every(function(e,o){return Number(e.properties.get("id"))!==c||(t.geoObjects.remove(e),r.splice(o,1),!1)},this),u||a.found++),this._selectedResult&&r.unshift(this._selectedResult),i&&i.geoObjects.getLength()?(n=n.concat(i.geoObjects.properties.getAll().resultsArray,r),s=n.length-1):(n=n.concat(r),s=n.length),this._state.set(l({},a,{isLoaded:!0,results:n,found:a.found})),this._requestCtx=a.requestContext,this._requestSkip=s,e){for(var d=this._resultCollection.toArray().slice(),h=0,g=d.length;h<g;h++)d[h]!==this._selectedResult&&this._resultCollection.remove(d[h]);i&&i.geoObjects.getLength()&&this._resultCollection.add(i.geoObjects.get(0),0)}this._resultCollection.fill(t.geoObjects);var m=this._findActiveItem();if(m&&this._resultCollection.setActiveChild(m),e){var f=t.responseMetaData;if(p.searchShowAdvert&&f){var I=l({},f.SearchRequest,f.SearchResponse);this._state.set("advert",I.Banners&&I.Banners[0])}}return t}},this)}return this._currentRequest},_checkPopupVisibility:function(){this._searchControl.isSelected()&&!this._canShowPopup()&&this._searchControl.deselect()},_firstRequestHandler:function(e){this._firstRequestDone=!0,e=e[0];var t=this._findActiveItem();t&&this._isSearchMode&&this._resultCollection.openChildBalloon(t),this._searchControl&&(this._checkButtonVisibility(),this._canShowPopup()&&this._searchControl.select())},_canShowPopup:function(){return!this._request.business_oid&&this._isSearchMode&&"full"===this._state.get("displayMode")&&(!this._map.controls.get("trafficControl").isExpanded()||this._map.container.getSize()[0]>=610)},_findActiveItem:function(){if(1===this._request.results)return this._resultCollection.get(0);var e,t=this._request.business_oid;return t&&this._resultCollection.each(function(o){var i=o.properties.get("id");if(Number(i)===t)return e=o,!1}),e},_onResultSelect:function(e){var t=e.get("index"),o=this._resultCollection.get(t);o&&this._resultCollection.openChildBalloon(o)},_getRequestObject:function(e){var t;if(e)t=l({},this._request),delete t.text,delete t.ctx;else{var o=c.toCenterAndSpan(this._map.getBounds(),this._map.options.get("projection"));o.ctx=this._requestCtx,o.skip=this._requestSkip,t=l({},this._request,o),t.text&&delete t.business_oid}return delete t.displayText,t},_onMapBoundsChange:function(){this._preventDataReload||(this._deselectButton(),this._makeRequest(!0))},_onChildAutopanStart:function(){this._preventDataReload=!0},_onChildAutopanEnd:function(){this._preventDataReload=!1},_onMapBalloonOpen:function(){this._deselectButton()},_onItemBalloonOpen:function(e){for(var t=e.get("target"),o=this._state.get("results"),i=0,s=o.length;i<s;i++)o[i]===t&&(this._selectedResult=t);this._setMapState(t.properties.get("id"))},_onItemBalloonClose:function(){this._selectedResult=null,this._setMapState()},_deselectButton:function(){this._searchControl&&this._searchControl.deselect()},_setMapState:function(e){var t={request:this._request.displayText,searchContext:this._request.ctx||this._requestCtx};this._isSearchMode&&f.setSearchDefault(this._map,t),e?(t.resultId=e,t.resultLayer="biz",f.setSearch(this._map,t)):f.resetSearch(this._map)},_checkButtonVisibility:function(){if(this._firstRequestDone){var e=this._searchControl.getParent(),t=this._state.get("displayMode");e&&"hidden"===t?this._map.controls.remove(this._searchControl):e||"hidden"===t||this._map.controls.add(this._searchControl)}}});e(function(e,t){var o=t.get("search");return o&&o.request?r.resolve(new I(e,t)):r.reject("no search data")})}),o.modules.define("mf.controller.traffic",["vow"],function(e,t){var o=["mon","tue","wed","thu","fri","sat","sun"];e(function(e,i){var s=t.defer(),n=i.get("traffic"),a=!1;if(n){var r=e.controls.get("trafficControl"),l={trafficShown:!0};if(n.provider){if(l.providerKey=n.provider,n.meta)if(r.getProvider(n.provider).state.set("infoLayerShown",n.meta.infoLayerShown),"traffic#archive"===n.provider){if(n.meta.dow&&n.meta.time&&o.indexOf(n.meta.dow)>-1){var c=n.meta.time.split(",");a=!0,r.getProvider(n.provider).setTime({dayOfWeek:n.meta.dow,hours:Number(c[0]),minutes:Number(c[1])},function(){s.resolve()})}}else r.getProvider(n.provider).state.set("timeOffset",Number(n.meta.offset));"traffic#actual"!==n.provider&&r.expand()}r.state.set(l)}return a||s.resolve(),s.promise()})}),o.modules.define("mf.geoObject.GhostWayPoint",["option.presetStorage","Placemark","map.associate.serviceGeoObjects","theme.islands.geoObject.multiRouter.preset"],function(e,t,o,i){function s(e){var o=t.get("islands#multiRouterSmall"),i={};for(var s in o){var n=s.replace("wayPoint","");n=n[0].toLowerCase()+n.substr(1),i[n]=o[s]}return i.iconColor=0===e?"#FF5858":"#5099FF",i.interactivityModel="default#silent",i}var n=function(e,t){this._map=e,this._index=t,this._map.events.add("mousemove",this._onMouseMove,this)};n.prototype.destroy=function(){this._map&&this._map.events.remove("mousemove",this._onMouseMove,this),this._placemark&&i.get(this._map).remove(this._placemark),this._placemark=null,this._map=null},n.prototype._onMouseMove=function(e){var t=e.get("coords");this._placemark?this._placemark.geometry.setCoordinates(t):(this._placemark=new o(t,{index:this._index},s(this._index)),i.get(this._map).add(this._placemark),this._placemark.getOverlay().then(function(e){e.getElement().style.opacity="0.6"}))},e(n)}),o.modules.define("main.styl",["system.provideCss"],function(e,t){t(".map-container,body,html{width:100%;height:100%;padding:0;margin:0;overflow:hidden}",e)}),o.modules.define("mf.main",["Map","mf.query","mf.meta.mapData","mf.preloadedMap","mf.controller.constructor","mf.controller.traffic","mf.controller.ruler","mf.controller.resize","mf.controller.points","mf.controller.search","mf.controller.route","mf.controller.scrollZoom","mf.controller.activeObjects","mf.util.yametrika","main.styl"],function(e,t,o,i,s,n,a,r,l,c,u,p,d,h){function g(){var e=document.createElement("div");return e.className="map-container",document.body.appendChild(e),e}var m=i(o,s),f=new t(g(),m.get("mapState"),m.get("mapOptions"));n(f,m),a(f,m),r(f,m),c(f,m),u(f,m),p(f,m),l(f,m),d(f,m),h(f,m),e(f)}),o.modules.define("mf.meta.config",["meta"],function(e,t){e({searchBalloonModeWidth:460,searchMinMapWidth:295,searchMinMapHeight:250,searchShowAdvert:"RU"===t.countryCode})}),o.modules.define("mf.meta.mapData",["data.Manager","mf.util.parseParams"],function(e,t,o){e(function(e,i){function s(e){var t=e.split(",");2===t.length&&(t=[Number(t[0]),Number(t[1])],isNaN(t[0])||isNaN(t[1])||(l.center=[t[0],t[1]]))}function n(e){var t=l.center,o=e.split(",");o=[Number(o[0]),Number(o[1])],isNaN(o[0])||isNaN(o[1])||(l.bounds=[[t[0]-o[0],t[1]-o[1]],[t[0]+o[0],t[1]+o[1]]])}function a(t,o){u.search={showControl:!0,request:{text:t,displayText:o||t,ctx:e.sctx,results:10}},e.sll&&(u.search.request.ll=e.sll.split(",")),e.sspn&&(u.search.request.spn=e.sspn.split(","))}function r(e){return o(e.substr(e.indexOf("?")+1))}var l={center:[0,0],zoom:10,controls:["geolocationControl","trafficControl","zoomControl","rulerControl"]},c={zoomControlSize:"small",suppressMapOpenBlock:!1,rulerBalloonAutoPan:!1,forceAdvert:!0},u={mapOptions:c,mapState:l,rulerState:e.rl};if(e.um){var p=e.um.split(":");1===p.length&&p.unshift("mymaps"),u.mapSid=p[1],u.mapSourceType=p[0],u.userMap=i}var d=i&&i.maps&&i.maps[0]&&i.maps[0].state;if(e.ll?s(e.ll):d&&d.center?l.center=d.center:e.rll?s(e.rll):e&&e.sll&&s(e.sll),e.mode&&["poi","search","whatshere"].indexOf(e.mode)>-1&&(u.mode=e.mode),e.z){var h=Number(e.z);l.zoom=isNaN(h)?l.zoom:h}else if(d&&d.zoom)l.zoom=Math.round(d.zoom);else if(e.rz){var g=Number(e.rz);l.zoom=isNaN(g)?l.zoom:g}else if(e.spn)n(e.spn);else if(e.sspn)n(e.sspn);else if(e.ouri){var m=r(e.ouri);m.spn&&n(m.spn)}var f={cur:"traffic#actual",arc:"traffic#archive","for":"traffic#forecast"};if(e.trfm&&f.hasOwnProperty(e.trfm)){if(u.traffic={},u.traffic.provider=f[e.trfm],u.traffic.meta={},e.trfst){var I=e.trfst.split("~");I.forEach(function(e){var t=e.split(":");u.traffic.meta[t[0]]=t[1]})}e.trfe&&(u.traffic.meta.infoLayerShown=!0)}else d&&d.traffic&&d.traffic.shown?u.traffic={}:e.l&&e.l.indexOf("trf")>-1&&(u.traffic={provider:"traffic#actual"},e.l.indexOf("trfe")>-1&&(u.traffic.meta={infoLayerShown:!0}));var v={pmbl:"islands#blueDotIcon",pmrd:"islands#redDotIcon",pmgn:"islands#greenDotIcon"};if(e.pt){u.placemarks=[];var _=e.pt.split("~");_.forEach(function(e){var t=e.split(","),o={geometry:{type:"Point",coordinates:[Number(t[0]),Number(t[1])]},options:{preset:v[t[2]]||"islands#blueDotIcon"}};u.placemarks.push(o)})}if(e.rtext){var y=e.rtext.split("~");u.route={wayPoints:[],type:"auto"};var M=y.length;y.forEach(function(e,t){var o=e.split(",");o=[Number(o[0]),Number(o[1])],isNaN(o[0])||isNaN(o[1])?(u.route.wayPoints.push(void 0),u.route.emptyIndex=t):u.route.wayPoints.push(o.reverse())}),1===M&&(u.route.emptyIndex=1,u.route.wayPoints.push(void 0));var C={auto:"auto",mt:"masstransit",pd:"pedestrian"};if(e.rtt&&C.hasOwnProperty(e.rtt)&&(u.route.type=C[e.rtt]),u.route.viaIndexes=[],e.via){var b=e.via.split("~");b.forEach(function(e){u.route.viaIndexes.push(Number(e))})}u.route.rtn=e.rtn||0,u.route.avoidTrafficJams="atm"!==e.rtm}if(e.chain?a("chain_id:("+e.chain+")",e.text):e.text&&a(e.text),e.ol)if(["biz","geo"].indexOf(e.ol)>-1){if(u.search=u.search||{request:{}},u.search.request.type=e.ol,"biz"===e.ol)u.search.request.business_oid=Number(e.oid);else if("geo"===e.ol){u.search=null;var w={text:e.text,type:"geo",uri:e.ouri,geometry:1,geocoder_pin:1,results:1};e.sll&&(w.ll=e.sll.split(",")),e.sspn&&(w.spn=e.sspn.split(",")),u.activeObjects=[{source:"search",request:w}]}}else delete u.search;if(u.search&&!u.mode&&(u.mode="search"),e["whatshere[point]"]){u.activeObjects=u.activeObjects||[];var A=Number(e["whatshere[zoom]"]),x=e["whatshere[point]"].split(",");x.map(function(e){return Number(e)}),u.activeObjects.push({source:"whatshere",position:[Number(x[0]),Number(x[1])],request:{text:x.reverse().join(","),z:A,geocoder_z:A,type:"geo",results:1,geometry:1,geocoder_pin:1}}),u.mode||(u.mode="whatshere")}if(e["poi[point]"]){var N=e["poi[point]"].split(",");N=[Number(N[0]),Number(N[1])],isNaN(N[0])||isNaN(N[1])||(u.poi=N,u.mode||(u.mode="poi"))}return new t(u)})}),o.modules.define("mf.search.Collection",["util.defineClass","GeoObjectCollection","util.pixelBounds","Monitor","GeoObject","util.extend","mf.meta.config","mf.util.ymapsLink","mf.hosts","util.preset","constants.zIndex","localization.common.current","theme.islets.search.popup.layout.Advert","theme.islets.search.layout.OpenInYmaps","theme.islets.search.layout.AddReviewButton"],function(e,t,o,i,s,n,a,r,l,c,u,p,d){var h=300,g=70,m=[0,16],f={geometrycollection:{strokeWidth:2,strokeOpacity:.7,strokeColor:"d54747",fillOpacity:.05,fillColor:"ff4141"},multilinestring:{strokeColor:"000000",strokeWidth:6,strokeOpacity:.35}},I="islands#blueCircleDotIcon",v=t(function(e){v.superclass.constructor.apply(this,arguments),this._state=e,this._stateMonitor=new s(this._state),this._stateMonitor.add("displayMode",this._setupBalloonDisplaying,this),this._setupBalloonDisplaying(),this.options.set({preset:I,balloonContentLayout:"islets#searchControlCardLayout",balloonCardStatusLayout:"islets#searchControlCardStatusLayout",balloonCardOpenInYmapsLayout:"islets#searchControlCardOpenInYmapsLayout",balloonCardAddReviewButtonLayout:"islets#searchControlCardAddReviewButtonLayout",balloonCardShowAdvert:!0,balloonCardShowReviewLink:!0,balloonMinHeight:150,balloonMinWidth:250,balloonMaxWidth:350,balloonPane:"mf.balloonPane",balloonCardAddOrgUrl:d.ppo.Card.spravAddUrl.replace("{mapsHost}",c.maps)}),this.events.add("add",this._onChildAdd,this).add("balloonopen",this._onBalloonOpen,this).add("balloonclose",this._onBalloonClose,this).add("click",this._onClick,this).add("mouseenter",this._onMouseEnter,this).add("mouseleave",this._onMouseLeave,this)},o,{fill:function(e){e.toArray().forEach(function(e){e.getParent()!==this&&this.add(e)},this)},openChildBalloon:function(e,t){e.getParent()===this&&(this.options.get("openBalloonOnClick",!0)?e.balloon.open():t&&this._openYmaps(e))},getActiveChild:function(){return this._lastActiveChild},setActiveChild:function(e){if(this._lastActiveChild&&this._lastActiveChild.getParent()===this&&(this._lastActiveChild.options.unset("zIndex"),u.removeFrom(this._lastActiveChild.options,"islands#redDotIconWithCaption")),e.getParent()===this){e.options.set("zIndex",p.hover-1);var t=this._getPreset(e);t&&u.removeFrom(e.options,t),u.addTo(e.options,"islands#redDotIconWithCaption");var o=e.properties;o.set("iconCaption",o.get("name")),this._lastActiveChild=e;var i=e.properties.get("figureGeometry");if(i){var s=i.type.toLocaleLowerCase(),r=new n({geometry:i},a({hasBalloon:!1,hasHint:!1,cursor:"grab"},f[s]));this.add(r)}}},_onChildAdd:function(e){var t=e.get("child"),o=t.properties.get("companyMetaData");o&&o.Advert&&u.addTo(t.options,"islands#violetCircleDotIcon")},_onClick:function(e){this.options.get("openBalloonOnClick",!0)===!1&&this._openYmaps(e.get("target"))},_openYmaps:function(e){window.open(l.getPlacemarkLink(e))},_onBalloonOpen:function(e){var t=this.getMap(),o=e.get("target");this._setupMapSizeCheck();var s;if(0===this.options.get("balloonPanelMaxMapArea")){var n=t.balloon.getOverlaySync().getShape().getBounds(),a=t.container.getSize(),r=t.getGlobalPixelCenter(),l=[[r[0]-a[0]/2,r[1]-a[1]/2],[r[0]+a[0]/2,r[1]+a[1]/2]];if(i.containsBounds(l,n))return void this.events.fire("childBalloonOpen",{target:o});s=a[1]<i.getSize(n)[1]?[i.getCenter(n)[0],n[1][1]-a[1]/2]:i.getCenter(n),s[0]+=m[0],s[1]+=m[1]}else s=t.options.get("projection").toGlobalPixels(o.geometry.getCoordinates(),t.getZoom());this.events.fire("childAutopanStart",{target:o}),t.setGlobalPixelCenter(s,t.getZoom(),{duration:h,useMapMargin:!0}).then(function(){this.events.fire("childAutopanEnd",{target:o})},this),this.events.fire("childBalloonOpen",{target:o})},_onBalloonClose:function(e){var t=e.get("target");t===this._lastРighlightedItem&&(this._clearPreset(this._lastРighlightedItem),this._lastРighlightedItem=null),this._teardownMapSizeCheck(),this.events.fire("childBalloonClose",{target:e.get("target")})},_setupMapSizeCheck:function(){this._checkSizeListener=this.getMap().events.group().add("sizechange",this._onMapSizeChange,this),this._onMapSizeChange()},_teardownMapSizeCheck:function(){this._checkSizeListener&&this._checkSizeListener.removeAll()},_onMapSizeChange:function(){this.options.set("balloonMaxHeight",this.getMap().container.getSize()[1]-g)},_setupBalloonDisplaying:function(){var e={openBalloonOnClick:!0,balloonAutoPan:!1},t=this._state.get("displayMode");"hidden"===t?e.openBalloonOnClick=!1:"compact"===t?e.balloonPanelMaxMapArea=1/0:e.balloonPanelMaxMapArea=0,this.options.set(e)},_onMouseEnter:function(e){this._lastРighlightedItem&&this._clearPreset(this._lastРighlightedItem);var t=e.get("target");if("point"===t.geometry.getType().toLowerCase()){var o=this._getPreset(t),i=this._getHoverPreset(o||I);t.options.set("hoverPreset",i).set("oldPreset",o).set("preset",i),this._lastРighlightedItem=t}else this._lastРighlightedItem=null},_onMouseLeave:function(){this._lastРighlightedItem&&(this._clearPreset(this._lastРighlightedItem),this._lastРighlightedItem=null)},_clearPreset:function(e){var t=e.options,o=t.get("hoverPreset");o&&u.removeFrom(t,o);var i=t.get("oldPreset");i&&u.addTo(t,i)},_getHoverPreset:function(e){var t=e.match(/#(.*?[A-Z].*?)(?:WithCaption|$)/);return t&&2===t.length?"islands#"+t[1]+"WithCaption":null},_getPreset:function(e){var t=e.options.get("preset");if("object"==typeof t&&t.hasOwnProperty("length")){var o=t;t=null,o.forEach(function(e){if("string"==typeof e)return t=e,!1})}return t}});e(v)}),o.modules.define("mf.search.Control",["vow","control.Button","util.defineClass","Monitor","pane.StaticPane","util.extend","mf.localization","mf.meta.config","mf.util.inlineImages"],function(e,t,i,s,n,a,r,l,c,u){
var p=s(function(e){e=e||{},p.superclass.constructor.call(this,e),this.options.set({maxWidth:120,size:"large"}),this.events.add("select",this._requirePopupItemLayout,this).add("deselect",this._destroyPopupItemLayout,this),this._stateMonitor=new n(this.state),this._stateMonitor.add("found",this._updateContent,this).add("displayMode",this._updateContent,this),this._updateContent()},i,{_requirePopupItemLayout:function(){this._popupPromise||(this._popupPromise=t.all([o.modules.require(["mf.search.PopupLayout"]),this.getLayout()]).spread(function(e,t){if(t.getElement()&&this._popupPromise){this._popupPromise=null;var o;if("full"===this.state.get("displayMode"))o=t.getElement().parentNode;else{var i=this.getMap();this._pane=new a(i,{zIndex:100500,css:{width:"100%",position:null,top:null,left:null}}),i.panes.append("mf.searchPopupPane",this._pane),o=this._pane.getElement(),i.panes.get("copyrights").getElement().style.display="none"}this._createPopupItemLayout(e[0],o)}},this))},_createPopupItemLayout:function(e,t){this._popupLayout||(this._popupLayout=new e({control:this,options:this.options,data:this.data,state:this.state,i18n:l,sharedState:this.state}),this._popupLayout.setParentElement(t),this._popupEvents=this._popupLayout.events.group().add("loadmorerequest",this._onLoadMoreRequest,this).add("resultselect",this._onResultSelect,this),this.events.fire("popupcreated"))},_destroyPopupItemLayout:function(){if(this._pane){var e=this._pane.getMap();e.panes.remove(this._pane),e.panes.get("copyrights").getElement().style.display=null,this._pane=null}this._popupLayout&&(this._popupLayout.setParentElement(null),this._popupLayout=null),this._popupEvents&&(this._popupEvents.removeAll(),this._popupPromise=null)},_onResultSelect:function(e){this.events.fire("resultselect",{index:e.get("index")})},_onLoadMoreRequest:function(){this.events.fire("loadmorerequest")},_updateContent:function(){var e={content:this.state.get("found","0").toString()},t=this.state.get("displayMode");"full"===t?(e.content=l.search_button_text.replace("%found%",e.content),e.image=null):e.image=u.getImage("search-button-icon"),this.data.set(e)}});e(p)}),o.modules.define("mf.search.displayModeHelper",["mf.meta.config"],function(e,t){function o(e,o){var i,s=e.container.getSize(),n=s[0],a=s[1];i=n<t.searchMinMapWidth||a<t.searchMinMapHeight?"hidden":n>=t.searchBalloonModeWidth?"full":"compact",o.set("displayMode",i)}e(function(e,t){e.events.add("sizechange",function(){o(e,t)},this),o(e,t)})}),o.modules.define("mf.search.inceptionHelper",["yandex.state.associate"],function(e,t){var o={setSearch:function(e,o){t.get(e).setSearch(o)},resetSearch:function(e){t.get(e).setSearch(e.state.get("mf_defaultYAState",null))},setSearchDefault:function(e,t){e.state.set("mf_defaultYAState",t)}};e(o)}),o.modules.define("searchPopupLayout.styl",["system.provideCss"],function(e,t){t(".search-popup{font-family:Arial;position:absolute;left:28px;top:43px;z-index:10000;box-shadow:inset 0 0 0 1px rgba(0,0,0,.15),0 8px 30px -5px rgba(0,0,0,.5);background-color:#fff}.search-popup__compact{width:100%;max-height:100%;top:0;left:0}.search-popup__compact .search-popup-header{border-bottom:1px solid #e3e3e3;padding-right:40px}.search-popup__compact .search-popup-inner{width:100%;margin-top:-1px}.search-popup-close-button{width:26px;height:28px;display:inline-block;border:1px solid #dadada;border-radius:1px;background-image:url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjYiIGhlaWdodD0iMjYiIHZpZXdCb3g9IjAgMCAyNiAyNiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48dGl0bGU+U2xpY2UgMTwvdGl0bGU+PHBhdGggZD0iTTEyIDEzbDEtMSAxIDEgNS41IDUgMS41LTEuNS03LTYuNS0xLTEtMSAxLTcgNi41TDYuNDk3IDE4IDEyIDEzem0wIDAiIGZpbGw9IiM5OTkiIGZpbGwtcnVsZT0iZXZlbm9kZCIvPjwvc3ZnPg==);position:absolute;right:10px;top:5px;cursor:pointer;z-index:101}.search-popup-inner{width:300px;overflow-y:auto;background-color:#fff}.search-popup-inner::-webkit-scrollbar{width:6px;height:13px}.search-popup-inner::-webkit-scrollbar-thumb{min-height:30px;box-shadow:inset 0 0 0 4px rgba(0,0,0,.2)}.search-popup-inner::-webkit-scrollbar-track{background:0 0}.search-popup-tail{position:absolute;left:20px;bottom:100%;margin-left:-17px;z-index:-100;width:17px;height:17px;background:rgba(0,0,0,.15);background:-webkit-linear-gradient(45deg,rgba(0,0,0,.15) 50%,rgba(0,0,0,0) 50%);background:linear-gradient(45deg,rgba(0,0,0,.15) 50%,rgba(0,0,0,0) 50%);font:0/0 a;transform:rotate(135deg);transform-origin:100% 100%}.search-popup-tail:after{content:'';position:absolute;bottom:1px;left:1px;width:17px;height:17px;background-color:#fff}.search-popup a{color:#0183c0;text-decoration:none}.search-popup a:hover{color:#c00}.search-popup-header{background-color:#fff;height:40px;line-height:40px;font-size:12px;padding:0 10px;position:relative;z-index:100;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.search-popup-more{border-top:2px solid #e5e5e5;height:30px;line-height:30px;text-align:center;font-size:14px;cursor:pointer;color:#0043ba;background-color:#fff}.search-popup-more:hover{color:#0183c0}.search-popup-footer{border-top:1px solid #e5e5e5;height:76px;font-size:13px;background:#f3f2ee url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+Cjxzdmcgd2lkdGg9IjQ0cHgiIGhlaWdodD0iNDRweCIgdmlld0JveD0iMCAwIDQ0IDQ0IiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHhtbG5zOnNrZXRjaD0iaHR0cDovL3d3dy5ib2hlbWlhbmNvZGluZy5jb20vc2tldGNoL25zIj4KICAgIDwhLS0gR2VuZXJhdG9yOiBTa2V0Y2ggMy41LjIgKDI1MjM1KSAtIGh0dHA6Ly93d3cuYm9oZW1pYW5jb2RpbmcuY29tL3NrZXRjaCAtLT4KICAgIDx0aXRsZT5NYXBGcmFtZV9ubyBzZWFyY2ggcmVzdWx0c19pY25fZmxhdHRlbjwvdGl0bGU+CiAgICA8ZGVzYz5DcmVhdGVkIHdpdGggU2tldGNoLjwvZGVzYz4KICAgIDxkZWZzPgogICAgICAgIDxjaXJjbGUgaWQ9InBhdGgtMSIgY3g9IjIyIiBjeT0iMjIiIHI9IjIyIj48L2NpcmNsZT4KICAgIDwvZGVmcz4KICAgIDxnIGlkPSJQYWdlLTEiIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIxIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiIHNrZXRjaDp0eXBlPSJNU1BhZ2UiPgogICAgICAgIDxnIGlkPSJNYXBGcmFtZV9uby1zZWFyY2gtcmVzdWx0c19pY25fZmxhdHRlbiIgc2tldGNoOnR5cGU9Ik1TQXJ0Ym9hcmRHcm91cCI+CiAgICAgICAgICAgIDxtYXNrIGlkPSJtYXNrLTIiIHNrZXRjaDpuYW1lPSJNYXNrIiBmaWxsPSJ3aGl0ZSI+CiAgICAgICAgICAgICAgICA8dXNlIHhsaW5rOmhyZWY9IiNwYXRoLTEiPjwvdXNlPgogICAgICAgICAgICA8L21hc2s+CiAgICAgICAgICAgIDx1c2UgaWQ9Ik1hc2siIGZpbGw9IiNGNkYwRDkiIHNrZXRjaDp0eXBlPSJNU1NoYXBlR3JvdXAiIHhsaW5rOmhyZWY9IiNwYXRoLTEiPjwvdXNlPgogICAgICAgICAgICA8cGF0aCBkPSJNMS40Njg1MjIzNiwyMyBMNDIuNTMxNDc3NiwyMyBMNDQsMjMgTDQ0LDE5IEw0Mi41MzE0Nzc2LDE5IEwxLjQ2ODUyMjM2LDE5IEwwLDE5IEwwLDIzIEwxLjQ2ODUyMjM2LDIzIEwxLjQ2ODUyMjM2LDIzIFoiIGlkPSJTaGFwZSIgZmlsbD0iI0ZEQ0M4QyIgc2tldGNoOnR5cGU9Ik1TU2hhcGVHcm91cCIgbWFzaz0idXJsKCNtYXNrLTIpIj48L3BhdGg+CiAgICAgICAgICAgIDxwYXRoIGQ9Ik0xNSwxLjQyNTEwMTIxIEwxNSw0Mi41NzQ4OTg4IEwxNSw0NCBMMTksNDQgTDE5LDQyLjU3NDg5ODggTDE5LDEuNDI1MTAxMjEgTDE5LDIuNTMxNDg4MjllLTE1IEwxNSwwIEwxNSwxLjQyNTEwMTIxIEwxNSwxLjQyNTEwMTIxIFoiIGlkPSJTaGFwZSIgZmlsbD0iI0ZEQ0M4QyIgc2tldGNoOnR5cGU9Ik1TU2hhcGVHcm91cCIgbWFzaz0idXJsKCNtYXNrLTIpIj48L3BhdGg+CiAgICAgICAgICAgIDxwYXRoIGQ9Ik02LDMwIEwwLDMwIEwwLDM5IEwxMiwzOSBMMTIsMzMuMSBMMTIsMjUgTDYsMjUgTDYsMzAgTDYsMzAgWiIgaWQ9IlJlY3RhbmdsZS04NDMiIGZpbGw9IiNFQ0UwQzUiIHNrZXRjaDp0eXBlPSJNU1NoYXBlR3JvdXAiIG1hc2s9InVybCgjbWFzay0yKSI+PC9wYXRoPgogICAgICAgICAgICA8cGF0aCBkPSJNMjIsMTUgTDQ0LDE1IEw0NCwtMSBMMjIsLTEgTDIyLDE1IEwyMiwxNSBaIiBpZD0iUmVjdGFuZ2xlLTg0NSIgZmlsbD0iI0VDRTBDNSIgc2tldGNoOnR5cGU9Ik1TU2hhcGVHcm91cCIgbWFzaz0idXJsKCNtYXNrLTIpIj48L3BhdGg+CiAgICAgICAgICAgIDxyZWN0IGlkPSJSZWN0YW5nbGUtODQyIiBmaWxsPSIjQ0VFMEMwIiBza2V0Y2g6dHlwZT0iTVNTaGFwZUdyb3VwIiBtYXNrPSJ1cmwoI21hc2stMikiIHg9IjMiIHk9IjAiIHdpZHRoPSIxMCIgaGVpZ2h0PSIxOCI+PC9yZWN0PgogICAgICAgICAgICA8cGF0aCBkPSJNMjEsMjUuOTk1MTA5NyBMNDYsMjUuOTk1MTA5NyBMNDYuNzUsNDUgTDIxLjA4MzMzMzMsNDQuNTI5NjE0OSBMMjEsMjUuOTk1MTA5NyBaIiBpZD0iUmVjdGFuZ2xlLTg0MSIgZmlsbD0iI0NFRTBDMCIgc2tldGNoOnR5cGU9Ik1TU2hhcGVHcm91cCIgbWFzaz0idXJsKCNtYXNrLTIpIj48L3BhdGg+CiAgICAgICAgICAgIDxnIGlkPSJtYXBzIiBza2V0Y2g6dHlwZT0iTVNMYXllckdyb3VwIiBtYXNrPSJ1cmwoI21hc2stMikiPgogICAgICAgICAgICAgICAgPGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMjMuMDAwMDAwLCAxMS4wMDAwMDApIiBpZD0iTGF5ZXJfMSI+CiAgICAgICAgICAgICAgICAgICAgPGc+CiAgICAgICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik03LDE0LjQgTDE0LDcuMiBDMTQsMTIgMTAuNSwxNS42IDQuNjY2NjY2NjcsMjQgTDcsMTQuNCBMNywxNC40IFoiIGlkPSJTaGFwZSIgZmlsbD0iI0NDMDAwMCIgc2tldGNoOnR5cGU9Ik1TU2hhcGVHcm91cCI+PC9wYXRoPgogICAgICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNNywwIEMxMC44NjI5NjMsMCAxNCwzLjIyNjY2NjY3IDE0LDcuMiBDMTQsMTEuMTczMzMzMyAxMC44NjI5NjMsMTQuNCA3LDE0LjQgQzMuMTM3MDM3MDQsMTQuNCAwLDExLjE3MzMzMzMgMCw3LjIgQzAsMy4yMjY2NjY2NyAzLjEzNzAzNzA0LDAgNywwIEw3LDAgWiIgaWQ9IlNoYXBlIiBmaWxsPSIjRUUwMDAwIiBza2V0Y2g6dHlwZT0iTVNTaGFwZUdyb3VwIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik03LjAwMDAwMDcyLDQuMzIgQzguNTU1NTU2MjQsNC4zMiA5LjgwMDAwMDY3LDUuNTY0NDQ0NDIgOS44MDAwMDA2Nyw3LjExOTk5OTk1IEM5LjgwMDAwMDY3LDguNjc1NTU1NDggOC41NTU1NTYyNCw5LjkxOTk5OTkgNy4wMDAwMDA3Miw5LjkxOTk5OTkgQzUuNDQ0NDQ1MTksOS45MTk5OTk5IDQuMjAwMDAwNzYsOC42NzU1NTU0OCA0LjIwMDAwMDc2LDcuMTE5OTk5OTUgQzQuMjAwMDAwNzYsNS41NjQ0NDQ0MiA1LjQ0NDQ0NTE5LDQuMzIgNy4wMDAwMDA3Miw0LjMyIEw3LjAwMDAwMDcyLDQuMzIgWiIgaWQ9IlNoYXBlIiBmaWxsPSIjRjZGNUYzIiBza2V0Y2g6dHlwZT0iTVNTaGFwZUdyb3VwIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPC9nPgogICAgICAgICAgICAgICAgPC9nPgogICAgICAgICAgICA8L2c+CiAgICAgICAgPC9nPgogICAgPC9nPgo8L3N2Zz4=) 14px 14px no-repeat;background-size:44px 44px;padding-left:76px}.search-popup-footer .caption{display:table;line-height:1.4em;height:100%}.search-popup-footer .caption div{display:table-cell;height:auto;vertical-align:middle}",e)}),o.modules.define("mf.search.PopupLayout",["mf.localization","templateLayoutFactory","searchPopupLayout.ymtpl","domEvent.manager","Monitor","mf.util.ymapsLink","util.dom.element","util.dom.style","theme.islands.control.search.layout.PopupItems","theme.islands.control.search.layout.PopupItem","theme.islets.control.search.layout.popupItem.Status","theme.islets.control.search.layout.Card","searchPopupLayout.styl"],function(e,t,o,i,s,n,a,r,l){var c="search-popup-",u=52,p=50,d=o.createClass(i,{build:function(){this.getData().options.set({popupItemLayout:"islands#searchControlPopupItemLayout",popupItemStatusLayout:"islets#searchControlPopupItemStatusLayout",popupAdvertLayout:"islets#searchControlPopupAdvertLayout"});var e=this.getData().state;this._popupState=e.get("popupState"),this._popupState&&this._popupState.requestId!==e.get("requestId")&&(this._popupState=null),d.superclass.build.apply(this,arguments),this._clickListener=s.group(this.getElement()).add("click",function(e){e.callMethod("stopPropagation")},this),this._setupHeader(),this._stateMonitor=new n(e),this._stateMonitor.add("found",this._checkLoadMoreButton,this).add("results",function(){this._checkLoadMoreButton(),this._setupPopHeight()},this),this._checkLoadMoreButton(),this._loadMoreEventGroup=s.group(this._findElem("more")).add("click",function(){this.events.fire("loadmorerequest")},this),this._mapEvents=this.getData().control.getMap().container.events.group().add("sizechange",this._setupPopHeight,this),this._setupPopHeight();var t=this._findElem("close-button");t&&(this._closeButtonGroup=s.group(t).add("click",function(){this.getData().control.deselect()},this)),this._updateYmapsLink(),this._innerListener=s.group(this._findElem("inner")).add("scroll",function(){var e=this.getData().state;e.set("popupState",{requestId:e.get("requestId"),scrollTop:this._findElem("inner").scrollTop})},this)},clear:function(){this._mapEvents.removeAll(),this._innerListener.removeAll(),this._loadMoreEventGroup.removeAll(),this._clickListener.removeAll(),this._stateMonitor.removeAll(),this._closeButtonGroup&&this._closeButtonGroup.removeAll(),d.superclass.clear.apply(this,arguments)},_updateYmapsLink:function(){var e=this.getData();this._findElem("ymaps-link").setAttribute("href",a.getSearchLink(e.control.getMap(),e.state.get("originRequest",{})))},_checkLoadMoreButton:function(){var e=this.getData(),t=e.state,o=e.state.get("found",10),i=t.get("results",[]).length,s=o>i,n=this._findElem("more");s&&(n.innerText=this._bindMoreText(Math.min(o-i,10))),n.style.display=s?"":"none"},_setupHeader:function(){var e=t.search_result.replace("%text%",this.getData().data.get("request").displayText),o=this._findElem("header");o.textContent?o.textContent=e:o.innerText=e},_setupPopHeight:function(){var e=this.getData(),t=this._findElem("inner"),o=e.control.getMap();if(o){var i=t.scrollTop||(this._popupState?this._popupState.scrollTop:0),s=o.container.getSize()[1];"full"===e.state.get("displayMode")?t.style.maxHeight=s-u-p+"px":(t.parentNode.style.height=null,l.getSize(t.parentNode)[1]===s&&(t.style.height="calc(100% - 40px)",t.parentNode.style.height=s+"px")),t.scrollTop=i}},_findElem:function(e){return r.find(this.getElement(),"."+c+e)},_bindMoreText:function(e){var t=this.getData().i18n.search_more_button,o=t.match(/(.*?)(%_found_%) (?:\((.*?)\|(.*?)\|(.*?)\))/);return[o[1],e," ",o[e>4?5:e<2?3:4]].join("")}});e(d)}),o.modules.define("searchPopupLayout.ymtpl",[],function(e){e([0,'<div class="search-popup',2003,"data.get(\"state.displayMode\") !== 'full'",0," search-popup__compact",2005,null,0,'">\n    ',2003,"data.get(\"state.displayMode\") !== 'full'",0,"\n        <div class=search-popup-header></div>\n        <div class=search-popup-close-button></div>\n    ",2005,null,0,"\n    <div class=search-popup-inner>\n        ",2003,"data.get(\"state.displayMode\") === 'full'",0,"\n            <div class=search-popup-header></div>\n        ",2005,null,0,"\n        ",2003,'data.get("state.advert") && data.get("options.popupAdvertLayout")',0,"\n            ",2002,["options.popupAdvertLayout",[]],0,"\n        ",2005,null,0,"\n        ",2002,["islands#searchControlPopupItemsLayout",[]],0,"\n        <div class=search-popup-more>\n            ",2001,["i18n.search_more_button",[["raw",null]]],0,"\n        </div>\n        <div class=search-popup-footer>\n            <div class=caption>\n                <div>\n                    ",2001,["i18n.search_footer",[["raw",null]]],0,"\n                </div>\n            </div>\n        </div>\n    </div>\n    ",2003,"data.get(\"state.displayMode\") !== 'compact'",0,"\n        <div class=search-popup-tail></div>\n    ",2005,null,0,"\n</div>"])}),o.modules.define("mf.search.provider",["mf.hosts","mf.env","mf.meta.config","yandex.searchProvider.storage","yandex.searchProvider.responseParser","yandex.timeZone","util.signedJsonp","localization.common.current","formatter","util.extend","vow"],function(e,t,o,i,s,n,a,r,l,c,u,p){var d=l.ppo.Card,h={search:function(e){var i=p.defer();return e=u({format:"json",lang:o.apiLocale,token:o.token,results:20,origin:"mapFrame2Search",snippets:["businessrating/2.x","masstransit/1.x"],ask_direct:1,apikey:o.apikey,type:"biz,web"},e),r({url:t.search+"v1/",requestParams:e}).then(this._addTimeZoneToResponse).then(function(e){if("success"!==e.status)return i.reject({message:"Bad response",status:e.status});var t=n.parseResults(e.data,e.timeZone);t.each(function(t,o){this._prepateItem(t,e.data.features[o])},this),i.resolve({geoObjects:t,responseMetaData:e.data.properties.ResponseMetaData})},function(e){i.reject(e)},this),i.promise()},_addTimeZoneToResponse:function(e){if(e.data&&e.data.features.length){var t=e.data.features[0],o=t.geometry.coordinates,i=p.defer();return a.get(o,10).then(function(t){i.resolve(u(e,{timeZone:{geoPoint:o,offset:t.offset,dst:t.dst}}))},function(){i.resolve(e)}),i.promise()}return p.resolve(e)},_prepateItem:function(e,t){var o=e.properties.get("type");"business"===o&&this._setLocalization(e),e.properties.set("figureGeometry",t.geometries[1]).set("iconCaption",e.properties.get("name")).set("displayAdvert",i.searchShowAdvert),e.options.set({balloonDisplayAdvert:!0,displayAdvert:!0})},_setLocalization:function(e){var t=e.properties,o=t.get("rating.reviews",0),i=t.get("rating.ratings",0);e.properties.set("loc",{timeClosedUntil:d.timeClosedUntil.replace("%s",t.get("workingStatus.time","")),timeOpenUntil:d.timeOpenUntil.replace("%s",t.get("workingStatus.time","")),ratingReviews:c.numeral(o,d.ratingReviews),ratingRatings:c.numeral(i,d.ratingRatings)})}};e(h)}),o.modules.define("mf.search.setupBalloonPane",["pane.MovablePane"],function(e,t){e(function(e){e.panes.get("mf.balloonPane")||e.panes.append("mf.balloonPane",new t(e,{zIndex:9999}))})}),o.modules.define("mf.util.id",[],function(e){var t=108;e({get:function(){return++t}})}),o.modules.define("inlineImages.styl",["system.provideCss"],function(e,t){t(".search-button-icon{background-image:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB3aWR0aD0iMjYiIGhlaWdodD0iMjYiIHZpZXdCb3g9IjAgMCAyNiAyNiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48dGl0bGU+TG91cGU8L3RpdGxlPjxnIGZpbGw9IiM2NjYiIGZpbGwtcnVsZT0iZXZlbm9kZCI+PHBhdGggZD0iTTE0LjkxNCAxNS42MmMyLjM0My0yLjM0MiAyLjM0My02LjE0IDAtOC40ODQtMi4zNDMtMi4zNDMtNi4xNDItMi4zNDMtOC40ODUgMC0yLjM0NCAyLjM0My0yLjM0NCA2LjE0MiAwIDguNDg1IDIuMzQyIDIuMzQ0IDYuMTQgMi4zNDQgOC40ODQgMHptLTEuNzY4LTEuNzY2YzEuMzY3LTEuMzY3IDEuMzY3LTMuNTgzIDAtNC45NS0xLjM2Ni0xLjM2Ny0zLjU4Mi0xLjM2Ny00Ljk1IDAtMS4zNjYgMS4zNjctMS4zNjYgMy41ODMgMCA0Ljk1IDEuMzY4IDEuMzY2IDMuNTg0IDEuMzY2IDQuOTUgMHptMCAwIi8+PHBhdGggZD0iTTEzLjE0NiAxNS45NzVsMi4xMjItMi4xMiA0Ljk1IDQuOTQ4LTIuMTIyIDIuMTIyeiIvPjwvZz48L3N2Zz4=)}",e)}),o.modules.define("mf.util.inlineImages",["inlineImages.styl"],function(e){e({getImage:function(e){var o=t("background-image","."+e),i=o.match(/(data:image.*?)(?:"|'|\))/);return i&&i[1]||""}})}),o.modules.define("mf.util.jsLoader",["vow"],function(e,t){e(function(e,o){var i=t.defer(),s=document.getElementsByTagName("head")[0],n=document.createElement("script"),a=function(){i.resolve(n),s.removeChild(n)};return n.charset="utf-8",n.src=e,o&&(n.async="async"),s.insertBefore(n,s.firstChild),n.onreadystatechange=function(){"complete"===this.readyState||"loaded"===this.readyState?i.resolve(n):i.reject()},n.onload=a,n.src=e,i.promise()})}),o.modules.define("mf.util.parseParams",function(e){e(function(e){var t=e.split("&"),o={};return t.forEach(function(e){var t=e.split("=");o[decodeURIComponent(t.shift())]=decodeURIComponent(t.join("="))}),o})}),o.modules.define("mf.util.yametrika",["mf.util.jsLoader","mf.env"],function(e,t,o){var i;o.yametrika&&o.yametrika.id&&(window.yandex_metrika_callbacks=[function(){i=new Ya.Metrika({id:o.yametrika.id,trackLinks:!0,accurateTrackBounce:!0})}],t("https://mc.yandex.ru/metrika/watch.js",!0)),e({reachGoal:function(e,t){i&&i.reachGoal(e,t)},params:function(e){i&&i.params(e)}})}),o.modules.define("mf.util.ymapsLink",["mf.hosts","util.bounds","util.extend"],function(e,t,o,i){e({getStateLink:function(e,o){var s={ll:e.getCenter().join(","),z:e.getZoom(),from:"mapframe"};o=o||{},o.sll&&(s.sll=s.ll),s=i({},o,s);var n=[];for(var a in s)s.hasOwnProperty(a)&&n.push(encodeURIComponent(a)+"="+encodeURIComponent(s[a]));return t.maps+"?"+n.join("&")},getPlacemarkLink:function(e){var o=e.properties,i=o.get("type"),s=e.geometry.getCoordinates().join(","),n=[t.maps,"?ll="+s,"&from=mapframe"];return"toponym"===i?n.push("&text="+encodeURIComponent(o.get("address"))):"business"===i&&n.push("&ol=biz&oid="+o.get("id")),n.join("")},getSearchLink:function(e,i){var s=o.toCenterAndSpan(e.getBounds(),e.options.get("projection"));i=i||{};var n=[t.maps,"?ll="+s.ll,"&spn="+s.spn,"&from=mapframe"];return(i.displayText||i.text)&&n.push("&text="+encodeURIComponent(i.displayText||i.text)),i.ctx&&n.push("&sctx="+encodeURIComponent(i.ctx)),n.join("")}})})}(this);
//# sourceMappingURL=maps/all.js.map
