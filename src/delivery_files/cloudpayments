var JSON,cp;JSON||(JSON={}),function(){"use strict";function i(n){return n<10?"0"+n:n}function f(n){return o.lastIndex=0,o.test(n)?'"'+n.replace(o,function(n){var t=s[n];return typeof t=="string"?t:"\\u"+("0000"+n.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+n+'"'}function r(i,e){var s,l,h,a,v=n,c,o=e[i];o&&typeof o=="object"&&typeof o.toJSON=="function"&&(o=o.toJSON(i));typeof t=="function"&&(o=t.call(e,i,o));switch(typeof o){case"string":return f(o);case"number":return isFinite(o)?String(o):"null";case"boolean":case"null":return String(o);case"object":if(!o)return"null";if(n+=u,c=[],Object.prototype.toString.apply(o)==="[object Array]"){for(a=o.length,s=0;s<a;s+=1)c[s]=r(s,o)||"null";return h=c.length===0?"[]":n?"[\n"+n+c.join(",\n"+n)+"\n"+v+"]":"["+c.join(",")+"]",n=v,h}if(t&&typeof t=="object")for(a=t.length,s=0;s<a;s+=1)typeof t[s]=="string"&&(l=t[s],h=r(l,o),h&&c.push(f(l)+(n?": ":":")+h));else for(l in o)Object.prototype.hasOwnProperty.call(o,l)&&(h=r(l,o),h&&c.push(f(l)+(n?": ":":")+h));return h=c.length===0?"{}":n?"{\n"+n+c.join(",\n"+n)+"\n"+v+"}":"{"+c.join(",")+"}",n=v,h}}typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+i(this.getUTCMonth()+1)+"-"+i(this.getUTCDate())+"T"+i(this.getUTCHours())+":"+i(this.getUTCMinutes())+":"+i(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var e=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,o=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,n,u,s={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},t;typeof JSON.stringify!="function"&&(JSON.stringify=function(i,f,e){var o;if(n="",u="",typeof e=="number")for(o=0;o<e;o+=1)u+=" ";else typeof e=="string"&&(u=e);if(t=f,f&&typeof f!="function"&&(typeof f!="object"||typeof f.length!="number"))throw new Error("JSON.stringify");return r("",{"":i})});typeof JSON.parse!="function"&&(JSON.parse=function(n,t){function r(n,i){var f,e,u=n[i];if(u&&typeof u=="object")for(f in u)Object.prototype.hasOwnProperty.call(u,f)&&(e=r(u,f),e!==undefined?u[f]=e:delete u[f]);return t.call(n,i,u)}var i;if(n=String(n),e.lastIndex=0,e.test(n)&&(n=n.replace(e,function(n){return"\\u"+("0000"+n.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(n.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return i=eval("("+n+")"),typeof t=="function"?r({"":i},""):i;throw new SyntaxError("JSON.parse");})}(),function(n,t,i,r,u,f){function b(n,t){var i=typeof n[t];return i=="function"||!!(i=="object"&&n[t])||i=="unknown"}function kt(n,t){return!!(typeof n[t]=="object"&&n[t])}function dt(n){return Object.prototype.toString.call(n)==="[object Array]"}function lt(){var i="Shockwave Flash",r="application/x-shockwave-flash",n,t,u,f;if(a(navigator.plugins)||typeof navigator.plugins[i]!="object"||(n=navigator.plugins[i].description,n&&!a(navigator.mimeTypes)&&navigator.mimeTypes[r]&&navigator.mimeTypes[r].enabledPlugin&&(w=n.match(/\d+/g))),!w)try{t=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");w=Array.prototype.slice.call(t.GetVariable("$version").match(/(\d+),(\d+),(\d+),(\d+)/),1);t=null}catch(e){}return w?(u=parseInt(w[0],10),f=parseInt(w[1],10),ht=u>9&&f>0,!0):!1}function it(){if(!y){y=!0;for(var n=0;n<tt.length;n++)tt[n]();tt.length=0}}function p(n,t){if(y){n.call(t);return}tt.push(function(){n.call(t)})}function gt(){var t=parent,n,i;if(d!=="")for(n=0,i=d.split(".");n<i.length;n++)t=t[i[n]];return t.easyXDM}function ni(t){return n.easyXDM=ei,d=t,d&&(c="easyXDM_"+d.replace(".","_")+"_"),e}function at(n){return n.match(st)[3]}function ti(n){return n.match(st)[4]||""}function o(n){var i=n.toLowerCase().match(st),r=i[2],u=i[3],t=i[4]||"";return(r=="http:"&&t==":80"||r=="https:"&&t==":443")&&(t=""),r+"//"+u+t}function nt(n){if(n=n.replace(fi,"$1/"),!n.match(/^(http||https):\/\//)){var t=n.substring(0,1)==="/"?"":i.pathname;t.substring(t.length-1)!=="/"&&(t=t.substring(0,t.lastIndexOf("/")+1));n=i.protocol+"//"+i.host+t+n}while(wt.test(n))n=n.replace(wt,"");return n}function k(n,t){var e="",r=n.indexOf("#"),u,i;r!==-1&&(e=n.substring(r),n=n.substring(0,r));u=[];for(i in t)t.hasOwnProperty(i)&&u.push(i+"="+f(t[i]));return n+(bt?"#":n.indexOf("?")==-1?"?":"&")+u.join("&")+e}function a(n){return typeof n=="undefined"}function s(n,t,i){var u;for(var r in t)t.hasOwnProperty(r)&&(r in n?(u=t[r],typeof u=="object"?s(n[r],u,i):i||(n[r]=t[r])):n[r]=t[r]);return n}function ii(){var n=t.body.appendChild(t.createElement("form")),i=n.appendChild(t.createElement("input"));i.name=c+"TEST"+pt;ut=i!==n.elements[i.name];t.body.removeChild(n)}function v(n){var i,e,r,u,f;if(a(ut)&&ii(),ut?i=t.createElement('<iframe name="'+n.props.name+'"/>'):(i=t.createElement("IFRAME"),i.name=n.props.name),i.id=i.name=n.props.name,delete n.props.name,typeof n.container=="string"&&(n.container=t.getElementById(n.container)),n.container||(s(i.style,{position:"absolute",top:"-2000px",left:"0px"}),n.container=t.body),e=n.props.src,n.props.src="javascript:false",s(i,n.props),i.border=i.frameBorder=0,i.allowTransparency=!0,n.container.appendChild(i),n.onLoad&&l(i,"load",n.onLoad),n.usePost){if(r=n.container.appendChild(t.createElement("form")),r.target=i.name,r.action=e,r.method="POST",typeof n.usePost=="object")for(f in n.usePost)n.usePost.hasOwnProperty(f)&&(ut?u=t.createElement('<input name="'+f+'"/>'):(u=t.createElement("INPUT"),u.name=f),u.value=n.usePost[f],r.appendChild(u));r.submit();r.parentNode.removeChild(r)}else i.src=e;return n.props.src=e,i}function ri(n,t){typeof n=="string"&&(n=[n]);for(var i,r=n.length;r--;)if(i=n[r],i=new RegExp(i.substr(0,1)=="^"?i:"^"+i.replace(/(\*)/g,".$1").replace(/\?/g,".")+"$"),i.test(t))return!0;return!1}function vt(r){var c=r.protocol,u,f;if(r.isHost=r.isHost||a(h.xdm_p),bt=r.hash||!1,r.props||(r.props={}),r.isHost)r.remote=nt(r.remote),r.channel=r.channel||"default"+pt++,r.secret=Math.random().toString(16).substring(2),a(c)&&(c=o(i.href)==o(r.remote)?"4":b(n,"postMessage")||b(t,"postMessage")?"1":r.swf&&b(n,"ActiveXObject")&&lt()?"6":navigator.product==="Gecko"&&"frameElement"in n&&navigator.userAgent.indexOf("WebKit")==-1?"5":r.remoteHelper?"2":"0");else if(r.channel=h.xdm_c.replace(/["'<>\\]/g,""),r.secret=h.xdm_s,r.remote=h.xdm_e.replace(/["'<>\\]/g,""),c=h.xdm_p,r.acl&&!ri(r.acl,r.remote))throw new Error("Access denied for "+r.remote);r.protocol=c;switch(c){case"0":if(s(r,{interval:100,delay:2e3,useResize:!0,useParent:!1,usePolling:!1},!0),r.isHost){if(!r.local){for(var v=i.protocol+"//"+i.host,y=t.body.getElementsByTagName("img"),l,p=y.length;p--;)if(l=y[p],l.src.substring(0,v.length)===v){r.local=l.src;break}r.local||(r.local=n)}f={xdm_c:r.channel,xdm_p:0};r.local===n?(r.usePolling=!0,r.useParent=!0,r.local=i.protocol+"//"+i.host+i.pathname+i.search,f.xdm_e=r.local,f.xdm_pa=1):f.xdm_e=nt(r.local);r.container&&(r.useResize=!1,f.xdm_po=1);r.remote=k(r.remote,f)}else s(r,{channel:h.xdm_c,remote:h.xdm_e,useParent:!a(h.xdm_pa),usePolling:!a(h.xdm_po),useResize:r.useParent?!1:r.useResize});u=[new e.stack.HashTransport(r),new e.stack.ReliableBehavior({}),new e.stack.QueueBehavior({encode:!0,maxLength:4e3-r.remote.length}),new e.stack.VerifyBehavior({initiate:r.isHost})];break;case"1":u=[new e.stack.PostMessageTransport(r)];break;case"2":r.isHost&&(r.remoteHelper=nt(r.remoteHelper));u=[new e.stack.NameTransport(r),new e.stack.QueueBehavior,new e.stack.VerifyBehavior({initiate:r.isHost})];break;case"3":u=[new e.stack.NixTransport(r)];break;case"4":u=[new e.stack.SameOriginTransport(r)];break;case"5":u=[new e.stack.FrameElementTransport(r)];break;case"6":w||lt();u=[new e.stack.FlashTransport(r)]}return u.push(new e.stack.QueueBehavior({lazy:r.lazy,remove:!0})),u}function yt(n){for(var i,u={incoming:function(n,t){this.up.incoming(n,t)},outgoing:function(n,t){this.down.outgoing(n,t)},callback:function(n){this.up.callback(n)},init:function(){this.down.init()},destroy:function(){this.down.destroy()}},t=0,r=n.length;t<r;t++)i=n[t],s(i,u,!0),t!==0&&(i.down=n[t-1]),t!==r-1&&(i.up=n[t+1]);return i}function ui(n){n.up.down=n.down;n.down.up=n.up;n.up=n.down=null}var rt=this,pt=Math.floor(Math.random()*1e4),ot=Function.prototype,st=/^((http.?:)\/\/([^:\/\s]+)(:\d+)*)/,wt=/[\-\w]+\/\.\.\//,fi=/([^:])\/\//g,d="",e={},ei=n.easyXDM,c="easyXDM_",ut,bt=!1,w,ht,l,g,y,tt,ft,ct,h,et;if(b(n,"addEventListener"))l=function(n,t,i){n.addEventListener(t,i,!1)},g=function(n,t,i){n.removeEventListener(t,i,!1)};else if(b(n,"attachEvent"))l=function(n,t,i){n.attachEvent("on"+t,i)},g=function(n,t,i){n.detachEvent("on"+t,i)};else throw new Error("Browser not supported");y=!1;tt=[];"readyState"in t?(ft=t.readyState,y=ft=="complete"||~navigator.userAgent.indexOf("AppleWebKit/")&&(ft=="loaded"||ft=="interactive")):y=!!t.body;y||(b(n,"addEventListener")?l(t,"DOMContentLoaded",it):(l(t,"readystatechange",function(){t.readyState=="complete"&&it()}),t.documentElement.doScroll&&n===top&&(ct=function(){if(!y){try{t.documentElement.doScroll("left")}catch(n){r(ct,1);return}it()}},ct())),l(n,"load",it));h=function(n){n=n.substring(1).split("&");for(var i={},t,r=n.length;r--;)t=n[r].split("="),i[t[0]]=u(t[1]);return i}(/xdm_e=/.test(i.search)?i.search:i.hash);et=function(){var n={},t={a:[1,2,3]},i='{"a":[1,2,3]}';return typeof JSON!="undefined"&&typeof JSON.stringify=="function"&&JSON.stringify(t).replace(/\s/g,"")===i?JSON:(Object.toJSON&&Object.toJSON(t).replace(/\s/g,"")===i&&(n.stringify=Object.toJSON),typeof String.prototype.evalJSON=="function"&&(t=i.evalJSON(),t.a&&t.a.length===3&&t.a[2]===3&&(n.parse=function(n){return n.evalJSON()})),n.stringify&&n.parse)?(et=function(){return n},n):null};s(e,{version:"2.4.19.3",query:h,stack:{},apply:s,getJSONObject:et,whenReady:p,noConflict:ni});e.DomHelper={on:l,un:g,requiresJSON:function(i){kt(n,"JSON")||t.write('<script type="text/javascript" src="'+i+'"><\/script>')}},function(){var n={};e.Fn={set:function(t,i){n[t]=i},get:function(t,i){if(n.hasOwnProperty(t)){var r=n[t];return i&&delete n[t],r}}}}();e.Socket=function(n){var t=yt(vt(n).concat([{incoming:function(t,i){n.onMessage(t,i)},callback:function(t){if(n.onReady)n.onReady(t)}}])),i=o(n.remote);this.origin=o(n.remote);this.destroy=function(){t.destroy()};this.postMessage=function(n){t.outgoing(n,i)};t.init()};e.Rpc=function(n,t){var i,r,u;if(t.local)for(i in t.local)t.local.hasOwnProperty(i)&&(r=t.local[i],typeof r=="function"&&(t.local[i]={method:r}));u=yt(vt(n).concat([new e.stack.RpcBehavior(this,t),{callback:function(t){if(n.onReady)n.onReady(t)}}]));this.origin=o(n.remote);this.destroy=function(){u.destroy()};u.init()};e.stack.SameOriginTransport=function(n){var t,u,f,h;return t={outgoing:function(n,t,i){f(n);i&&i()},destroy:function(){u&&(u.parentNode.removeChild(u),u=null)},onDOMReady:function(){h=o(n.remote);n.isHost?(s(n.props,{src:k(n.remote,{xdm_e:i.protocol+"//"+i.host+i.pathname,xdm_c:n.channel,xdm_p:4}),name:c+n.channel+"_provider"}),u=v(n),e.Fn.set(n.channel,function(n){return f=n,r(function(){t.up.callback(!0)},0),function(n){t.up.incoming(n,h)}})):(f=gt().Fn.get(n.channel,!0)(function(n){t.up.incoming(n,h)}),r(function(){t.up.callback(!0)},0))},init:function(){p(t.onDOMReady,t)}}};e.stack.FlashTransport=function(n){function w(n){r(function(){l.up.incoming(n,y)},0)}function b(i){var r=n.swf+"?host="+n.isHost,c="easyXDM_swf_"+Math.floor(Math.random()*1e4),o;e.Fn.set("flash_loaded"+i.replace(/[\-.]/g,"_"),function(){var n,t;for(e.stack.FlashTransport[i].swf=u=h.firstChild,n=e.stack.FlashTransport[i].queue,t=0;t<n.length;t++)n[t]();n.length=0});n.swfContainer?h=typeof n.swfContainer=="string"?t.getElementById(n.swfContainer):n.swfContainer:(h=t.createElement("div"),s(h.style,ht&&n.swfNoThrottle?{height:"20px",width:"20px",position:"fixed",right:0,top:0}:{height:"1px",width:"1px",position:"absolute",overflow:"hidden",right:0,top:0}),t.body.appendChild(h));o="callback=flash_loaded"+f(i.replace(/[\-.]/g,"_"))+"&proto="+rt.location.protocol+"&domain="+f(at(rt.location.href))+"&port="+f(ti(rt.location.href))+"&ns="+f(d);h.innerHTML="<object height='20' width='20' type='application/x-shockwave-flash' id='"+c+"' data='"+r+"'><param name='allowScriptAccess' value='always'><\/param><param name='wmode' value='transparent'><param name='movie' value='"+r+"'><\/param><param name='flashvars' value='"+o+"'><\/param><embed type='application/x-shockwave-flash' FlashVars='"+o+"' allowScriptAccess='always' wmode='transparent' src='"+r+"' height='1' width='1'><\/embed><\/object>"}var l,a,y,u,h;return l={outgoing:function(t,i,r){u.postMessage(n.channel,t.toString());r&&r()},destroy:function(){try{u.destroyChannel(n.channel)}catch(t){}u=null;a&&(a.parentNode.removeChild(a),a=null)},onDOMReady:function(){y=n.remote;e.Fn.set("flash_"+n.channel+"_init",function(){r(function(){l.up.callback(!0)})});e.Fn.set("flash_"+n.channel+"_onMessage",w);n.swf=nt(n.swf);var t=at(n.swf),f=function(){e.stack.FlashTransport[t].init=!0;u=e.stack.FlashTransport[t].swf;u.createChannel(n.channel,n.secret,o(n.remote),n.isHost);n.isHost&&(ht&&n.swfNoThrottle&&s(n.props,{position:"fixed",right:0,top:0,height:"20px",width:"20px"}),s(n.props,{src:k(n.remote,{xdm_e:o(i.href),xdm_c:n.channel,xdm_p:6,xdm_s:n.secret}),name:c+n.channel+"_provider"}),a=v(n))};e.stack.FlashTransport[t]&&e.stack.FlashTransport[t].init?f():e.stack.FlashTransport[t]?e.stack.FlashTransport[t].queue.push(f):(e.stack.FlashTransport[t]={queue:[f]},b(t))},init:function(){p(l.onDOMReady,l)}}};e.stack.PostMessageTransport=function(t){function y(n){if(n.origin)return o(n.origin);if(n.uri)return o(n.uri);if(n.domain)return i.protocol+"//"+n.domain;throw"Unable to retrieve the origin of the event";}function a(n){var i=y(n);i==h&&n.data.substring(0,t.channel.length+1)==t.channel+" "&&f.up.incoming(n.data.substring(t.channel.length+1),i)}var f,u,e,h;return f={outgoing:function(n,i,r){e.postMessage(t.channel+" "+n,i||h);r&&r()},destroy:function(){g(n,"message",a);u&&(e=null,u.parentNode.removeChild(u),u=null)},onDOMReady:function(){if(h=o(t.remote),t.isHost){var y=function(i){i.data==t.channel+"-ready"&&(e="postMessage"in u.contentWindow?u.contentWindow:u.contentWindow.document,g(n,"message",y),l(n,"message",a),r(function(){f.up.callback(!0)},0))};l(n,"message",y);s(t.props,{src:k(t.remote,{xdm_e:o(i.href),xdm_c:t.channel,xdm_p:1}),name:c+t.channel+"_provider"});u=v(t)}else l(n,"message",a),e="postMessage"in n.parent?n.parent:n.parent.document,e.postMessage(t.channel+"-ready",h),r(function(){f.up.callback(!0)},0)},init:function(){p(f.onDOMReady,f)}}};e.stack.FrameElementTransport=function(u){var f,e,l,a;return f={outgoing:function(n,t,i){l.call(this,n);i&&i()},destroy:function(){e&&(e.parentNode.removeChild(e),e=null)},onDOMReady:function(){a=o(u.remote);u.isHost?(s(u.props,{src:k(u.remote,{xdm_e:o(i.href),xdm_c:u.channel,xdm_p:5}),name:c+u.channel+"_provider"}),e=v(u),e.fn=function(n){return delete e.fn,l=n,r(function(){f.up.callback(!0)},0),function(n){f.up.incoming(n,a)}}):(t.referrer&&o(t.referrer)!=h.xdm_e&&(n.top.location=h.xdm_e),l=n.frameElement.fn(function(n){f.up.incoming(n,a)}),f.up.callback(!0))},init:function(){p(f.onDOMReady,f)}}};e.stack.NameTransport=function(n){function l(i){var r=n.remoteHelper+(t?"#_3":"#_2")+n.channel;u.contentWindow.sendMessage(i,r)}function a(){t?++w!=2&&t||i.up.callback(!0):(l("ready"),i.up.callback(!0))}function y(n){i.up.incoming(n,b)}function tt(){h&&r(function(){h(!0)},0)}var i,t,u,f,w,h,b,d;return i={outgoing:function(n,t,i){h=i;l(n)},destroy:function(){u.parentNode.removeChild(u);u=null;t&&(f.parentNode.removeChild(f),f=null)},onDOMReady:function(){t=n.isHost;w=0;b=o(n.remote);n.local=nt(n.local);t?(e.Fn.set(n.channel,function(i){t&&i==="ready"&&(e.Fn.set(n.channel,y),a())}),d=k(n.remote,{xdm_e:n.local,xdm_c:n.channel,xdm_p:2}),s(n.props,{src:d+"#"+n.channel,name:c+n.channel+"_provider"}),f=v(n)):(n.remoteHelper=n.remote,e.Fn.set(n.channel,y));var i=function(){var t=u||this;g(t,"load",i);e.Fn.set(n.channel+"_load",tt),function f(){typeof t.contentWindow.sendMessage=="function"?a():r(f,50)}()};u=v({props:{src:n.local+"#_4"+n.channel},onLoad:i})},init:function(){p(i.onDOMReady,i)}}};e.stack.HashTransport=function(t){function d(n){if(i){var r=t.remote+"#"+b+++"_"+n;(l||!h?i.contentWindow:i).location=r}}function g(n){e=n;u.up.incoming(e.substring(e.indexOf("_")+1),k)}function nt(){if(f){var t=f.location.href,n="",i=t.indexOf("#");i!=-1&&(n=t.substring(i));n&&n!=e&&g(n)}}function a(){y=setInterval(nt,w)}var u,tt=this,l,y,w,e,b,f,i,h,k;return u={outgoing:function(n){d(n)},destroy:function(){n.clearInterval(y);(l||!h)&&i.parentNode.removeChild(i);i=null},onDOMReady:function(){if(l=t.isHost,w=t.interval,e="#"+t.channel,b=0,h=t.useParent,k=o(t.remote),l){if(s(t.props,{src:t.remote,name:c+t.channel+"_provider"}),h)t.onLoad=function(){f=n;a();u.up.callback(!0)};else{var y=0,p=t.delay/50;(function d(){if(++y>p)throw new Error("Unable to reference listenerwindow");try{f=i.contentWindow.frames[c+t.channel+"_consumer"]}catch(n){}f?(a(),u.up.callback(!0)):r(d,50)})()}i=v(t)}else f=n,a(),h?(i=parent,u.up.callback(!0)):(s(t,{props:{src:t.remote+"#"+t.channel+new Date,name:c+t.channel+"_consumer"},onLoad:function(){u.up.callback(!0)}}),i=v(t))},init:function(){p(u.onDOMReady,u)}}};e.stack.ReliableBehavior=function(){var n,t,i=0,r=0,u="";return n={incoming:function(f,e){var s=f.indexOf("_"),o=f.substring(0,s).split(",");f=f.substring(s+1);o[0]==i&&(u="",t&&t(!0));f.length>0&&(n.down.outgoing(o[1]+","+i+"_"+u,e),r!=o[1]&&(r=o[1],n.up.incoming(f,e)))},outgoing:function(f,e,o){u=f;t=o;n.down.outgoing(r+","+ ++i+"_"+f,e)}}};e.stack.QueueBehavior=function(n){function s(){if(n.remove&&i.length===0){ui(t);return}if(!o&&i.length!==0&&!c){o=!0;var u=i.shift();t.down.outgoing(u.data,u.origin,function(n){o=!1;u.callback&&r(function(){u.callback(n)},0);s()})}}var t,i=[],o=!0,e="",c,l=0,v=!1,h=!1;return t={init:function(){a(n)&&(n={});n.maxLength&&(l=n.maxLength,h=!0);n.lazy?v=!0:t.down.init()},callback:function(n){o=!1;var i=t.up;s();i.callback(n)},incoming:function(i,r){if(h){var f=i.indexOf("_"),o=parseInt(i.substring(0,f),10);e+=i.substring(f+1);o===0&&(n.encode&&(e=u(e)),t.up.incoming(e,r),e="")}else t.up.incoming(i,r)},outgoing:function(r,u,e){n.encode&&(r=f(r));var c=[],o;if(h){while(r.length!==0)o=r.substring(0,l),r=r.substring(o.length),c.push(o);while(o=c.shift())i.push({data:c.length+"_"+o,origin:u,callback:c.length===0?e:null})}else i.push({data:r,origin:u,callback:e});v?t.down.init():s()},destroy:function(){c=!0;t.down.destroy()}}};e.stack.VerifyBehavior=function(n){function u(){i=Math.random().toString(16).substring(2);t.down.outgoing(i)}var t,i,r;return t={incoming:function(f,e){var o=f.indexOf("_");o===-1?f===i?t.up.callback(!0):r||(r=f,n.initiate||u(),t.down.outgoing(f)):f.substring(0,o)===r&&t.up.incoming(f.substring(o+1),e)},outgoing:function(n,r,u){t.down.outgoing(i+"_"+n,r,u)},callback:function(){n.initiate&&u()}}};e.stack.RpcBehavior=function(n,t){function i(n){n.jsonrpc="2.0";r.down.outgoing(f.stringify(n))}function o(n,t){var r=Array.prototype.slice;return function(){var f=arguments.length,s,o={method:t};f>0&&typeof arguments[f-1]=="function"?(f>1&&typeof arguments[f-2]=="function"?(s={success:arguments[f-2],error:arguments[f-1]},o.params=r.call(arguments,0,f-2)):(s={success:arguments[f-1]},o.params=r.call(arguments,0,f-1)),u[""+ ++e]=s,o.id=e):o.params=r.call(arguments,0);n.namedParams&&o.params.length===1&&(o.params=o.params[0]);i(o)}}function s(n,t,r,u){var f,e,o;if(!r){t&&i({id:t,error:{code:-32601,message:"Procedure not found."}});return}t?(f=function(n){f=ot;i({id:t,result:n})},e=function(n,r){e=ot;var u={id:t,error:{code:-32099,message:n}};r&&(u.error.data=r);i(u)}):f=e=ot;dt(u)||(u=[u]);try{o=r.method.apply(r.scope,u.concat([f,e]));a(o)||f(o)}catch(s){e(s.message)}}var r,f=t.serializer||et(),e=0,u={};return r={incoming:function(n){var r=f.parse(n),e;r.method?t.handle?t.handle(r,i):s(r.method,r.id,t.local[r.method],r.params):(e=u[r.id],r.error?e.error&&e.error(r.error):e.success&&e.success(r.result),delete u[r.id])},init:function(){if(t.remote)for(var i in t.remote)t.remote.hasOwnProperty(i)&&(n[i]=o(t.remote[i],i));r.down.init()},destroy:function(){for(var i in t.remote)t.remote.hasOwnProperty(i)&&n.hasOwnProperty(i)&&delete n[i];r.down.destroy()}}};rt.easyXDM=e}(window,document,location,window.setTimeout,decodeURIComponent,encodeURIComponent),function(n){n.serverSettings={widget:{rootUrl:"https://widget.cloudpayments.ru",errorHandlerUrl:"",easyXDMSwfPath:"/scripts/easyxdm.swf",paymentIFramePath:"/payframe.html",desktopPayformPathFormat:"/payforms/{0}/desktop/index.html",popupPath:"/payframe_mobile.html",threeDSPopupCallbackPath:"/Home/ThreeDSPopupCallback",merchantBundlePath:"/bundles/cloudpayments",threeDSCallbackPath:"/Home/ThreeDSCallback",loadingImagePath:"/images/overlay-loading.gif",dummyPath:"/dummy.html",binLogoServicePath:"/Home/BinLogo",api:{checkedThreeDSDataProcessingPath:"/Payments/CheckTransactionStatusAfter3DSecure",threeDSDataProcessingPath:"/Payments/Post3DS",authPath:"/Payments/Auth",chargePath:"/Payments/Charge"},qr:{rootUrl:"https://qr.cloudpayments.ru",paymentPath:"/QROperation/payment",waitToReadyOrCompletePath:"/QROperation/WaitToReadyOrComplete",createPath:"/QROperation/Create",completePath:"/QROperation/Complete"},localizations:{startButtonText:{ru:"Перейти к оплате",en:"Proceed to payment",lv:"Pāriet uz maksājumu"}},defaultCulture:"ru",detectedCulture:""}}}(cp||(cp={})),function(n){(function(n){n[n.none=0]="none";n[n.iFrameOnly=1]="iFrameOnly";n[n.iFrameAndPopup=2]="iFrameAndPopup"})(n.PostMessageSupport||(n.PostMessageSupport={}));var t=n.PostMessageSupport,i=function(){function n(){this.device={};var n=navigator.userAgent.match(/(iPad|iPhone|iPod)/g);n&&(this.device[n[0]]={});this.browser={ie:this.detectIE(),chromeForIOS:this.detectChromeForIOS(),safariForIOS:this.detectSafariForIOS(),androidBrowser:this.detectAndroidBrowser(),yandexBrowser:this.detectYandexBrowser(),facebookForIOS:this.detectFacebookForIOS()};this.features={hasSmallScreen:this.detectSmallScreen()||this.device.iPad,supportsCors:"withCredentials"in new XMLHttpRequest,postMessageSupport:this.detectPostMessageSupport(),supportsViewPortUnits:this.detectViewPortUnitsSupport(),hasVirtualKeyboard:!!(this.detectSmallScreen()||this.device.iPad),useCookieResult:this.device.iPhone}}return n.prototype.detectViewPortUnitsSupport=function(){var n,t;try{if(n=this.browser.androidBrowser,n)return n.version?(t=n.version.split("."),t.length>1&&parseInt(t[0])==4&&parseInt(t[1])>4):!1}catch(i){}return!(this.browser.ie&&this.browser.ie.version<9)},n.prototype.detectPostMessageSupport=function(){if(!("postMessage"in window)||this.browser.ie&&this.browser.ie.version<9)return t.none;var n=!!(this.device.iPhone||this.device.iPad||this.device.iPod);return this.browser.ie?t.iFrameOnly:t.iFrameAndPopup},n.prototype.detectSmallScreen=function(){var n,t;return this.device.iPhone?!0:window.screen?(n=window.screen.width,window.devicePixelRatio&&window.screen.width/window.devicePixelRatio===window.innerWidth&&(n=window.innerWidth),t=window.screen&&n<=760&&n>0,t)?!0:!1:!1},n.prototype.detectFacebookForIOS=function(){var n=!!(this.device.iPhone||this.device.iPad||this.device.iPod),t=navigator.userAgent.toUpperCase().indexOf("FBAN/")>-1;return n&&t?{}:null},n.prototype.detectChromeForIOS=function(){return/(CriOS)/g.test(navigator.userAgent)?{}:null},n.prototype.detectYandexBrowser=function(){return navigator.userAgent.indexOf("YaBrowser")>-1?{}:null},n.prototype.detectSafariForIOS=function(){var n=/(iPad|iPhone|iPod)/g.test(navigator.userAgent);return n&&!this.detectChromeForIOS()&&!this.detectYandexBrowser()&&!this.detectFacebookForIOS()?{}:null},n.prototype.detectIE=function(){var n=navigator.userAgent.match(/MSIE\s+([0-9\.]+);/i);return n&&n.length>1?{version:parseInt(n[1],10)}:null},n.prototype.detectAndroidBrowser=function(){var i=navigator.userAgent.indexOf("Android")>-1&&navigator.userAgent.indexOf("Mozilla/5.0")>-1&&navigator.userAgent.indexOf("AppleWebKit")>-1,n=/AppleWebKit\/([\d.]+)/.exec(navigator.userAgent),t=n===null?null:parseFloat(n[1]),r=i&&t!==null&&t<537;if(r){function u(n){var t=n.match(/android\s([0-9\.]+)/i)||n.match(/android[; ]+release\/([0-9\.]+)/i);return t?t[1]:null}return{version:u(navigator.userAgent)}}return null},n}();n.ClientSettings=i;n.clientSettings=new i}(cp||(cp={})),function(n){var i=function(){function n(){}return n.addEventListener=function(n,t,i){if(n.addEventListener)n.addEventListener(t,i,!1);else{var r=function(n){return n||(n=window.event),typeof n.keyCode!="undefined"&&(n.which=n.keyCode),typeof n.srcElement!="undefined"&&(n.target=n.srcElement),n.preventDefault||(n.preventDefault=function(){this.returnValue=!1}),i(n)};i._normalizingHandler=r;n.attachEvent("on"+t,r)}},n.removeEventListener=function(n,t,i){if(n.removeEventListener)n.removeEventListener(t,i,!1);else{var r=i._normalizingHandler;n.detachEvent("on"+t,r||i)}},n.show=function(n){n.style.display="";setTimeout(function(){n.style.opacity="1"},15)},n.createAndSubmitForm=function(n,t,i){var r=n.createElement("form"),f,u;r.action=t;r.method="POST";for(f in i)i.hasOwnProperty(f)&&(u=n.createElement("input"),u.type="hidden",u.name=f,u.value=i[f],r.appendChild(u));n.body.appendChild(r);r.submit()},n.hide=function(n){n.style.opacity="0";n.style.display="none"},n.sendPost=function(t,i,r,u,f){return n.sendRequest(t,"POST",i,r,u,f)},n.sendGet=function(t,i,r,u,f){return n.sendRequest(t,"GET",i,r,u,f)},n.sendPostAndReturnJson=function(t,i,r,u,f){return n.sendPost(t,i,function(n){r&&r(JSON.parse(n))},u,f)},n.sendGetAndReturnJson=function(t,i,r,u,f){return n.sendGet(t,i,function(n){r&&r(JSON.parse(n))},u,f)},n.removeSpaces=function(n){return n.replace(/ /g,"")},n.isHtmlElement=function(n){return"HTMLElement"in window&&n instanceof HTMLElement||n&&typeof n=="object"&&n!==null&&n.nodeType===1&&typeof n.nodeName=="string"},n.createQuery=function(n){var t=[];for(var i in n)t.push(encodeURIComponent(i)+"="+encodeURIComponent(n[i]));return t.length===0?"":t.join("&")},n.parseQuery=function(n){var u={},f,i,t,r;if(n&&n.length>0)for(f=n.charAt(0)==="?"?n.substring(1):n,i=f.split("&"),t=0;t<i.length;t++){r=i[t].split("=");try{u[decodeURIComponent(r[0])]=decodeURIComponent(r[1])}catch(e){}}return u},n.sendRequest=function(t,i,r,u,f,e){var o,s;if(r&&typeof r!="object")throw new Error("Argument 'data' must me a parameter name-value map");if(o=n.createXMLHttpRequest(),!o)throw Error("XMLHttpRequest is not supported");if(o.readyState==4)throw Error("XMLHttpRequest is in invalid state 'completed' before sending");if(s=null,i==="POST")o.open(i,t,!0),o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),s=n.createQuery(r);else if(i==="GET")o.open(i,n.appendQueryToUrl(t,r),!0);else throw new Error("Invalid HTTP method '"+i+"'");return o.onreadystatechange=function(){var n=this;n.readyState==4&&(o.onreadystatechange=null,n.status!=200&&n.status!=304?f&&f(n.responseText):u&&u(n.responseText),e&&e(n.responseText))},o.send(s),o},n.appendQueryToUrl=function(t,i){var u,r;if(typeof i!="object")throw new TypeError("Argument 'data' must be an object");return(u=n.createQuery(i),!u)?t:(r=document.createElement("a"),r.href=t,r.search+=(r.search?"&":"?")+u,r.href)},n.createXMLHttpRequest=function(){try{return new XMLHttpRequest}catch(n){}try{return new ActiveXObject("Msxml3.XMLHTTP")}catch(n){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(n){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(n){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(n){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(n){}return null},n.addClass=function(n,t){n.className+=" "+t},n.isClosedWindow=function(n){return!n||!("closed"in n)||n.closed},n.trackWindowClose=function(t,i){return n.setIntervalUntil(i,function(){return n.isClosedWindow(t)},500)},n.removeClass=function(n,t){for(var i=n.className;i.indexOf(t)!=-1;)i=i.replace(t,""),i=i.trim();n.className=i},n.format=function(n){for(var i=[],t=1;t<arguments.length;t++)i[t-1]=arguments[t];if(!n)throw new Error("Argument 'formatString' must be specified");return n.replace(/{(\d+)}/g,function(n,t){var r=parseInt(t),u;if(isNaN(r))throw new Error("Invalid format string argument '"+t+"'");if(u=i[r],typeof u=="undefined")throw new Error("Format string argument "+r+" must be provided");return u})},n.forEach=function(n,t){for(var i=0;i<n.length;i++)t(n[i],i)},n.indexOf=function(n,t,i){if(typeof n=="undefined"||n===null)throw new TypeError('"this" is null or not defined');var r=n.length>>>0;for(i=+i||0,Math.abs(i)===Infinity&&(i=0),i<0&&(i+=r,i<0&&(i=0));i<r;i++)if(n[i]===t)return i;return-1},n.isNullOrUndefined=function(n){return n===null||typeof n=="undefined"},n.setIntervalUntil=function(n,t,i){var r=setInterval(function(){t()&&(clearInterval(r),n())},i,t);return{cancel:function(){r&&(clearInterval(r),r=null)}}},n}(),t,r;n.Utils=i;t=function(){function n(n){n===void 0&&(n=window.location.search);this.map=i.parseQuery(n);this.queryLowerCase={};for(var t in this.map)this.queryLowerCase[t.toLowerCase()]=this.map[t]}return n.prototype.getValue=function(n){return this.queryLowerCase[n.toLowerCase()]},n}();n.QueryParams=t;n.queryParams=new t;"Prototype"in window&&(r=JSON.stringify,JSON.stringify=function(n){var i=Array.prototype.toJSON,t;return delete Array.prototype.toJSON,t=r(n),Array.prototype.toJSON=i,t})}(cp||(cp={})),function(n){var t,i;(function(n){n[n.childOk=0]="childOk";n[n.parentOk=1]="parentOk";n[n.command=2]="command"})(t||(t={}));i=function(){function i(t,r,u){var o=this,e,s,f;if(this.options=t,this.methods=r,e=this.getChannelId(),e?(this.channelId=e,this.isChild=!0):(this.channelId=Math.random().toString(),this.isChild=!1),this.localOrigin=i.getOrigin(window.location.href),this.remoteOrigin=i.getOrigin(t.remote),!window.postMessage)throw new Error("Browser does not support window.postMessage");s=this;n.Utils.addEventListener(window,"message",function(n){return s.receiveMessage(n)});this.bindRemoteMethods(this.methods.remote);this.isChild?(this.targetWindow=u?window.opener:window.parent,u||n.clientSettings.features.useCookieResult?setTimeout(function(){return o.ready()},10):this.sendChildOk()):u?(this.targetWindow=window.open(n.Utils.appendQueryToUrl(t.remote,{channelId:this.channelId}),"_blank"),setTimeout(function(){return o.ready()},10)):(f=document.createElement("iframe"),f.name=this.getWindowNameFromChannelId(this.channelId),f.src=t.remote,t.container.appendChild(f),this.targetWindow=f.contentWindow)}return i.prototype.getChannelId=function(){return this.getChannelIdFromWindowName()||n.queryParams.getValue("channelid")},i.prototype.getChannelIdFromWindowName=function(){if(window.name){var n=window.name.indexOf("cp.rpc.");if(n===0)return window.name.substring(7)}return null},i.prototype.getWindowNameFromChannelId=function(n){return"cp.rpc."+n},i.prototype.bindRemoteMethods=function(n){for(var t in n)n.hasOwnProperty(t)&&this.addRemoteMethod(t)},i.prototype.addRemoteMethod=function(n){var t=this;this[n]=function(){t.sendCommand({name:n,arguments:Array.prototype.slice.call(arguments)})}},i.prototype.receiveMessage=function(n){if(this.remoteOrigin===n.origin){var i=JSON.parse(n.data);if(this.channelId===i.channelId)switch(i.type){case t.childOk:if(this.isChild)throw new Error("Invalid message: 'childOk' must not be received by a child");else{this.targetWindow&&this.sendParentOk();this.ready();return}case t.parentOk:if(this.isChild){this.ready();return}throw new Error("Invalid message: 'parentOk' must not be received by a parent");case t.command:this.executeCommand(i.command);return;default:throw new Error("Invalid MessageType value "+i.type);}}},i.prototype.executeCommand=function(n){if(!n.name||!n.arguments)throw new Error("Invalid command");if(!this.methods.local.hasOwnProperty(n.name))throw new Error("Local RPC method '"+n.name+"' is not defined");var t=this.methods.local[n.name];t.apply(this,n.arguments)},i.prototype.sendChildOk=function(){if(!this.isChild)throw new Error("RPC is not a child");this.postMessage({type:t.childOk,channelId:this.channelId})},i.prototype.sendParentOk=function(){if(this.isChild)throw new Error("RPC is not a parent");this.postMessage({type:t.parentOk,channelId:this.channelId})},i.prototype.sendCommand=function(n){if(!this.isReady)throw new Error("RPC is not ready");this.postMessage({type:t.command,channelId:this.channelId,command:n})},i.prototype.postMessage=function(n){this.targetWindow.postMessage(JSON.stringify(n),this.remoteOrigin)},i.prototype.ready=function(){this.isReady||(this.isReady=!0,this.options.onReady&&this.options.onReady())},i.getOrigin=function(n){var t=document.createElement("a"),i,r;return(t.href=n,t.origin)?t.origin:(i=t.protocol+"//"+t.hostname,t.port&&(r=i+":"+t.port,n.indexOf(r)===0))?r:i},i}();n.PostMessageRpc=i}(cp||(cp={})),function(n){var t=function(){function t(){}return t.createRpc=function(t,i,r){if(r===void 0&&(r=!1),r&&n.clientSettings.features.postMessageSupport!==n.PostMessageSupport.iFrameAndPopup)throw new Error("Popup mode is not supported");return!r&&n.clientSettings.features.postMessageSupport===n.PostMessageSupport.none?new easyXDM.Rpc(t,i):new n.PostMessageRpc(t,i,r)},t}();n.RpcFatory=t}(cp||(cp={})),function(n){(function(n){n[n.cardData=0]="cardData";n[n.qrCode=1]="qrCode"})(n.PaymentMethod||(n.PaymentMethod={}));var t=n.PaymentMethod}(cp||(cp={})),function(n){var t=function(){function n(){}return n.supportsHashTransportOnly=function(){var t=n.getMajorFlashVersion();return!n.supportsPostMessageApi()},n.supportsPostMessageApi=function(){return typeof postMessage=="function"},n.getMajorFlashVersion=function(){function i(n){return(n=n.match(/[\d]+/g),!n)?"":(n.length=3,n.join("."))}var t=!1,n="",r,u,e;if(navigator.plugins&&navigator.plugins.length)r=navigator.plugins["Shockwave Flash"],r&&(t=!0,r.description&&(n=i(r.description))),navigator.plugins["Shockwave Flash 2.0"]&&(t=!0,n="2.0.0.11");else if(navigator.mimeTypes&&navigator.mimeTypes.length)u=navigator.mimeTypes["application/x-shockwave-flash"],(t=u&&u.enabledPlugin)&&(n=i(u.enabledPlugin.description));else try{var f=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7"),t=!0,n=i(f.GetVariable("$version"))}catch(o){try{f=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");t=!0;n="6.0.21"}catch(s){try{f=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");t=!0;n=i(f.GetVariable("$version"))}catch(h){}}}return e=n,t?parseInt(n.split(".")[0],10):null},n}();n.TransportSupportHelper=t}(cp||(cp={})),function(n){var i=function(){function n(){this.isReady=!1}return n.prototype.ready=function(){this.isReady=!0;this.callable&&this.callable()},n.prototype.setCallable=function(n){this.callable=n;this.isReady&&this.callable()},n}(),r=function(){function i(i,r){var e=t.ensureContainer(i),u,f;this.container=t.createContainerWithBackdrop();u=document.createElement("div");u.style.cssText="display: table; text-align: center; position: absolute; z-index: 10000; width: 100%; height: 100%;";f=document.createElement("div");f.style.cssText="display: table-cell; vertical-align: middle;";this.startButton=document.createElement("button");this.startButton.style.cssText="text-align: center; border-width: 0; text-decoration: none; background: #389de0; background-image: linear-gradient(to bottom, #389de0, #258ecf); border-radius: 8px; font-family: Arial; color: #ffffff; font-size: 26px; display: inline-block; line-height: 30px; padding: 15px; margin: 0;";this.startButton.id="cp-mobile-start-button";n.clientSettings.features.supportsViewPortUnits?(this.startButton.style.fontSize="8vw",this.startButton.style.padding="5vw",this.startButton.style.lineHeight="9vw",this.startButton.style.borderRadius="3vw"):typeof innerWidth!="undefined"&&window.innerWidth>0&&(this.startButton.style.fontSize=Math.ceil(window.innerWidth*.083)+"px",this.startButton.style.padding=Math.ceil(window.innerWidth*.05)+"px",this.startButton.style.lineHeight=Math.ceil(window.innerWidth*.085)+"px",this.startButton.style.borderRadius=Math.ceil(window.innerWidth*.025)+"px");this.startButton.innerHTML=this.getStartButtonText(r);this.hide();f.appendChild(this.startButton);u.appendChild(f);this.container.appendChild(u);e.appendChild(this.container)}return i.prototype.getStartButtonText=function(t){var r=n.serverSettings.widget.localizations.startButtonText[t],i,u;return r?r:(i={en:"Proceed to payment",lv:"Pāriet uz maksājumu",ru:"Перейти к оплате",az:"ÖDƏNİŞ SƏHİFƏSİNƏ KEÇMƏK",uk:"Перейти до оплати"},u=t.substring(0,2),i[u]||i.ru)},i.prototype.show=function(){n.Utils.show(this.container)},i.prototype.hide=function(){n.Utils.hide(this.container)},i.prototype.setClickHandler=function(n){var t=this;this.startButton.onclick=function(){t.hide();n.call(this,arguments)}},i}(),t=function(){function t(i){var c=this,e,s,h;if(i===void 0&&(i={}),i.showPaymentMethods&&typeof i.showPaymentMethods!="boolean")throw new Error("Option 'showPaymentMethods' must be a boolean");this.setCloudPaymentsOptionsDefaults(i);this.widgetOptions=i;i.openWindow?i.startWithButton&&(e=t.ensureContainer(i.container),this.startButtonWidget=new r(e,i.language||n.serverSettings.widget.detectedCulture||n.serverSettings.widget.defaultCulture),this.startButtonWidget.setClickHandler(function(){return c.initRpc()})):(this.container=t.createContainerWithBackdrop(),this.hideWindow(),e=t.ensureContainer(i.container),e.appendChild(this.container));i.showLoadingImage&&(s=this.createLoadingOverlay(),document.body.appendChild(s));var u=this,f={swf:n.serverSettings.widget.rootUrl+n.serverSettings.widget.easyXDMSwfPath,container:this.container,onReady:function(){if(i.openWindow){var t=u.rpc.targetWindow;u.operation.popupWindowTracker=n.Utils.trackWindowClose(t,function(){n.clientSettings.features.useCookieResult?u.waitForPaymentResultFromCookies():u.tryCompleteOperation({success:!1,message:"User has cancelled"})&&(u.operation=null)})}else u.iframe=u.container.getElementsByTagName("iframe")[0],u.iframe.style.cssText="height:100%;width:100%;position: fixed;z-index:9999;border:0;";i.showLoadingImage&&document.body.removeChild(s)}},o={showPaymentMethods:i.showPaymentMethods,defaultPaymentMethod:i.defaultPaymentMethod};i.language&&(o.language=i.language);i.openWindow&&(o.openWindow=i.openWindow,this.openWindow=i.openWindow);o.mainWindowHref=window.location.href;h=i.openWindow?n.serverSettings.widget.popupPath:this.getSkinPath(this.widgetOptions.skin);f.remote=n.Utils.format("{0}{1}?{2}",n.serverSettings.widget.rootUrl,h,n.Utils.createQuery(o));n.TransportSupportHelper.supportsHashTransportOnly()&&delete f.swf;this.initRpc=function(){var r=u.widgetOptions.openWindow?t.cloneMerge(f,{remote:f.remote+"#"+encodeURIComponent(JSON.stringify(u.operation.options))}):f;this.rpc=n.RpcFatory.createRpc(r,{local:{showWindow:function(){u.showWindow()},hideWindow:function(){u.hideWindow()},completeOperation:function(n){u.openWindow||u.hideWindow();u.tryCompleteOperation(n)&&(u.operation&&u.operation.popupWindowTracker&&u.operation.popupWindowTracker.cancel(),u.operation=null)},needOptions:function(){u.notifyWidgetIsReadyToReceiveOptions()}},remote:{setOptions:{},closeWindow:{}}},i.openWindow)};this.openWindow||this.initRpc()}return t.prototype.waitForPaymentResultFromCookies=function(){var i="cp_result",t=document.getElementById(i);t&&document.removeChild(t);t=document.createElement("iframe");t.id=i;t.src=n.Utils.appendQueryToUrl(n.serverSettings.widget.rootUrl+"/cookiegrabber.html",{channelId:this.rpc.channelId,remoteOrigin:this.rpc.localOrigin,noCookieResult:JSON.stringify({success:!1,message:"User has cancelled"})});t.style.display="none";document.body.appendChild(t)},t.cloneMerge=function(n,t){var r={};for(var i in n)r[i]=n[i];for(i in t)r[i]=t[i];return r},t.prototype.getSkinPath=function(t){return n.Utils.format(n.serverSettings.widget.desktopPayformPathFormat,t||"cards")},t.prototype.setCloudPaymentsOptionsDefaults=function(t){n.Utils.isNullOrUndefined(t.showLoadingImage)&&(t.showLoadingImage=!0);n.Utils.isNullOrUndefined(t.openWindow)&&(t.openWindow=n.clientSettings.features.hasSmallScreen&&n.clientSettings.features.postMessageSupport===n.PostMessageSupport.iFrameAndPopup);n.Utils.isNullOrUndefined(t.startWithButton)&&(t.startWithButton=!0);t.showLoadingImage=t.showLoadingImage&&!t.openWindow;t.showPaymentMethods=t.showPaymentMethods||!1;n.Utils.isNullOrUndefined(t.defaultPaymentMethod)&&(t.defaultPaymentMethod=n.PaymentMethod.cardData)},t.prototype.createLoadingOverlay=function(){var i=document.createElement("div"),t;return i.style.cssText="position: fixed; top: 0; left: 0; width: 100%; height: 100%; text-align: center; background-color: transparent; z-index: 9999;",t=document.createElement("img"),t.style.cssText="position: relative; top:50%;",t.src=n.serverSettings.widget.rootUrl+n.serverSettings.widget.loadingImagePath,i.appendChild(t),i},t.prototype.charge=function(n,t,i,r){this.auth(n,t,i,r,!1)},t.prototype.createCryptogram=function(n,t,i,r){n.cryptogramMode=!0;this.auth(n,t,i,r,!1)},t.prototype.auth=function(t,i,r,u,f){var e,o;if(f===void 0&&(f=!0),!t.amount)throw new Error("Option 'amount' must be specified");if(typeof t.amount!="number")throw new Error("Option 'amount' must be a number");if(!t.currency)throw new Error("Option 'currency' must be specified");if(t.email&&typeof t.email!="string")throw new Error("Option 'email' must be a string");if(u&&typeof u!="function")throw new Error("Argument 'onCompleted' must be a function");if(f&&typeof f!="boolean")throw new Error("Argument 'auth' must be a boolean");if(t.requireEmail&&typeof t.requireEmail!="boolean")throw new Error("Argument 'requireEmail' must be a boolean");if(!t.email&&this.widgetOptions.email&&(t.email=this.widgetOptions.email),t.auth=f,e={options:t,onCompleted:u},i)switch(typeof i){case"function":e.onSuccess=i;break;case"string":e.onSuccessUrl=i;break;default:throw new Error("Argument 'onSuccess' must be a function or URL string");}if(r)switch(typeof r){case"function":e.onFail=r;break;case"string":e.onFailUrl=r;break;default:throw new Error("Argument 'onFail' must be a function or URL string");}if(this.openWindow&&this.rpc&&(o=this.rpc.targetWindow,o&&(this.operation&&this.operation.popupWindowTracker&&this.operation.popupWindowTracker.cancel(),!n.Utils.isClosedWindow(o))))try{this.rpc.closeWindow()}catch(s){}this.operation=e;this.openWindow&&(this.startButtonWidget?this.startButtonWidget.show():this.initRpc());this.notifyPaymentOptionsCreated(t)},t.prototype.notifyPaymentOptionsCreated=function(n){var t=this;(this.openWindow||!this.optionsNotifier)&&(this.optionsNotifier=new i);this.optionsNotifier.setCallable(function(){return t.rpc.setOptions(n)})},t.prototype.notifyWidgetIsReadyToReceiveOptions=function(){this.optionsNotifier||(this.optionsNotifier=new i);this.optionsNotifier.ready()},t.prototype.updateObject=function(n,t){for(var i in t)n[i]=t[i]},t.prototype.showWindow=function(){this.container&&(n.clientSettings.browser.ie&&n.clientSettings.browser.ie.version<7&&this.fixIE6IFrameSize(),n.Utils.show(this.container))},t.prototype.hideWindow=function(){n.Utils.hide(this.container)},t.prototype.tryCompleteOperation=function(n){var t=this.operation;if(!t||t.completed)return!1;if(t.completed=!0,n.success)if(t.onSuccess)t.onSuccess(t.options,n.data);else t.onSuccessUrl&&(window.location.href=t.onSuccessUrl);else if(t.onFail)t.onFail(n.message,t.options);else t.onFailUrl&&(window.location.href=t.onFailUrl);if(t.onCompleted)t.onCompleted(n,t.options);return!0},t.createContainerWithBackdrop=function(){var n=document.createElement("div"),t;return n.style.cssText="z-index:9997;text-align:left;height:100%;width:100%;position:fixed;left:0;top:0;transition: opacity 0.15s",t=document.createElement("div"),t.style.cssText="filter: alpha(opacity=50);z-index:9998;background:#000;opacity:0.6;position:fixed;left:0;top:0;bottom:0;right:0;border:0;overflow:visible;",n.appendChild(t),n},t.ensureContainer=function(n){if(!n)return document.body;if(typeof n=="string")return document.getElementById(n);if(typeof n=="object"&&n.nodeType===1)return n;throw new Error("Argument 'container' must be an ID of element or the element itself");},t.prototype.fixIE6IFrameSize=function(){typeof document.body.style.maxHeight=="undefined"&&(this.iframe.style.height=document.documentElement.clientHeight.toString()+"px",this.iframe.style.width=document.documentElement.clientWidth.toString()+"px")},t}();n.CloudPayments=t}(cp||(cp={}))